<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Fairy Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --card: #111827;
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.12);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f97316;
      --radius: 14px;
      --gap: 10px;
      --font: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 14px;
      font-family: var(--font);
      color: var(--text);
      background: radial-gradient(circle at top, #111827 0, #020817 40%, #000 100%);
    }
    h1 {
      font-size: 1.4rem;
      margin: 0 0 4px;
      font-weight: 600;
    }
    h2 {
      font-size: 1.1rem;
      margin: 14px 0 6px;
      font-weight: 500;
    }
    p {
      margin: 4px 0;
      font-size: 0.85rem;
      color: var(--muted);
    }
    select, button {
      font-family: var(--font);
      font-size: 0.9rem;
    }
    .shell {
      max-width: 680px;
      margin: 0 auto;
    }
    .card {
      background: rgba(9,12,23,0.96);
      border-radius: var(--radius);
      padding: 10px 10px 12px;
      margin-bottom: 10px;
      box-shadow: 0 8px 26px rgba(0,0,0,0.55);
      border: 1px solid rgba(148,163,253,0.06);
      backdrop-filter: blur(18px);
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: var(--gap);
      align-items: center;
    }
    .row > * {
      flex: 1 1 auto;
      min-width: 0;
    }
    .lang-select {
      max-width: 180px;
    }
    .pill-label {
      font-size: 0.78rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* Personality toggles */
    .personalities {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    .personality {
      font-size: 0.75rem;
      padding: 4px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,253,0.18);
      color: var(--muted);
      cursor: pointer;
      user-select: none;
      background: rgba(15,23,42,0.9);
    }
    .personality.selected {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--accent);
      font-weight: 500;
    }

    /* Skill checkboxes */
    .skills {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    .skills label {
      font-size: 0.74rem;
      padding: 3px 6px;
      border-radius: 8px;
      border: 1px solid rgba(75,85,99,0.9);
      display: inline-flex;
      gap: 4px;
      align-items: center;
      color: var(--muted);
      cursor: pointer;
    }
    .skills input {
      transform: scale(1.05);
    }

    .btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: #020817;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
      box-shadow: 0 8px 18px rgba(56,189,248,0.35);
    }
    .btn span.icon { font-size: 1rem; }

    .output {
      font-size: 0.8rem;
      line-height: 1.5;
      margin-top: 4px;
      white-space: pre-wrap;
    }
    .food-line {
      margin: 1px 0;
    }
    .warn {
      color: var(--danger);
      font-size: 0.78rem;
    }
  </style>
</head>
<body>
<div class="shell">
  <div class="card">
    <div class="row">
      <div>
        <h1>My Fairy Food Planner</h1>
        <p id="subtitle">
          Plan what to feed your fairy to hit all 10 traits & unlock every School skill.
        </p>
      </div>
      <div class="lang-select">
        <label for="lang" class="pill-label">
          üåê <span id="lang-label">Language</span>
        </label>
        <select id="lang">
          <option value="en">English</option>
          <option value="fr">Fran√ßais</option>
        </select>
      </div>
    </div>
  </div>

  <div class="card">
    <h2 id="start-title">Starting personalities</h2>
    <p id="start-help">
      Tap the personalities your fairy already has. This slightly shifts how foods are suggested.
    </p>
    <div class="personalities" id="personalities"></div>
  </div>

  <div class="card">
    <h2 id="skills-title">Target skill traits</h2>
    <p id="skills-help">
      These 10 traits correspond to the School skills. Leave all checked if you‚Äôre aiming to unlock everything.
    </p>
    <div class="skills" id="skills"></div>
  </div>

  <div class="card">
    <h2 id="plan-title">Get a feeding plan</h2>
    <p id="plan-help">
      This suggests a simple mix of foods (bronze / Tasty / Delicious) using in-game EN/FR names and trait values from the Legends/Definitive guide.
    </p>
    <button class="btn" id="plan-btn">
      <span class="icon">‚ú®</span><span id="plan-btn-label">Suggest foods</span>
    </button>
    <div class="output" id="plan-output"></div>
    <div class="warn" id="plan-warning"></div>
  </div>
</div>

<script>
/*
  DATA MODEL

  - Traits are fixed 10:
    Sparkly, Relaxed, Valiant, Dizzy, Friendly,
    Aspiring, Resolute, Shrewd, Eager, Smiley

  - Each food entry:
    {
      key: "weird-egg-bronze",
      base: "Weird Egg",
      name_en: "Weird Egg",
      name_fr: "≈íuf √©trange",
      rarity: "bronze" | "silver" | "gold",
      rarity_label_en: "bronze" / "Tasty (silver)" / "Delicious (gold)",
      rarity_label_fr: "bronze" / "Savoureux (argent)" / "D√©licieux (or)",
      type: "Feast" | "Drink" | "Plant" | "Fish" | "Weird",
      element: "Fire" | "Water" | "Lightning" | "Light" | "Darkness" | "Neutral" | "Earth" | "Wind",
      traits: { Sparkly: +/-, ..., Smiley: +/- }
    }

  - Values are transcribed from the GameFAQs "My Fairy Unlockables ‚Üí Dining Room" table
    (1st row = bronze, 2nd = silver/Tasty, 3rd = gold/Delicious). Gratitude Crystals are intentionally excluded.
*/

// base helpers
const TRAITS = [
  "Sparkly","Relaxed","Valiant","Dizzy","Friendly",
  "Aspiring","Resolute","Shrewd","Eager","Smiley"
];

// Personality labels = official-ish localized names mapping onto traits (not literal translations).
const PERSONALITY_DEF = [
  { trait: "Sparkly",  en: "Sparkly",   fr: "√âtincelante" },
  { trait: "Relaxed",  en: "Soft",      fr: "Douce" },
  { trait: "Valiant",  en: "Flashy",    fr: "Tape-√†-l‚Äô≈ìil" },
  { trait: "Dizzy",    en: "Wavy",      fr: "√âtourdissante" },
  { trait: "Friendly", en: "Kind",      fr: "Gentille" },
  { trait: "Aspiring", en: "Dreamy",    fr: "R√™veuse" },
  { trait: "Resolute", en: "Staunch",   fr: "R√©solue" },
  { trait: "Shrewd",   en: "Fleet",     fr: "Rapide" },
  { trait: "Eager",    en: "Eager",     fr: "Impatiente" },
  { trait: "Smiley",   en: "Cheerful",  fr: "Joyeuse" },
];

// Build FOODS from table (main + weird foods, without Gratitude Crystals).
// Note: if any single entry looks off vs your reference, adjust that one line.
const FOODS = [
  // ===== FEASTS =====
  // Weird Egg
  f("Weird Egg","≈íuf √©trange","Feast","Neutral",
    [2,0,2,0,-1,0,2,0,0,0],
    [5,-2,2,0,0,0,5,0,2,0],
    [10,-5,5,-2,2,0,5,0,2,0]),
  // All-purpose Bait
  f("All-purpose Bait","App√¢t universel","Feast","Light",
    [0,0,-1,0,2,0,2,0,0,2],
    [2,0,0,0,5,0,2,0,-2,5],
    [2,0,2,0,5,-2,5,-2,-5,10]),
  // Ordon Goat Cheese
  f("Ordon Goat Cheese","Fromage de ch√®vre d‚ÄôOrdon","Feast","Darkness",
    [0,2,2,0,0,0,2,0,-1,0],
    [0,2,5,-2,0,2,5,0,0,0],
    [-2,5,10,-5,0,2,5,-2,2,0]),
  // Meat
  f("Meat","Viande","Feast","Fire",
    [0,-1,2,0,0,0,2,2,0,0],
    [0,0,5,-2,2,0,0,5,2,0],
    [0,2,10,-5,2,0,-2,5,5,-2]),

  // ===== DRINKS =====
  // Lon Lon Milk
  f("Lon Lon Milk","Lait de Lon Lon","Drink","Light",
    [2,0,-1,0,0,2,0,2,0,0],
    [2,0,0,0,2,0,5,-2,5,0],
    [5,-2,2,0,2,0,10,-5,5,-2]),
  // Pumpkin Soup
  f("Pumpkin Soup","Soupe √† la citrouille","Drink","Fire",
    [0,0,0,-1,2,0,2,0,2,0],
    [2,0,0,0,2,0,5,-2,5,0],
    [2,0,0,2,5,-2,10,-5,5,-2]),
  // Sacred Water
  f("Sacred Water","Eau sacr√©e","Drink","Light",
    [2,0,0,-1,2,0,2,0,0,0],
    [5,-2,0,0,5,0,2,0,2,0],
    [10,-5,0,2,5,-2,5,-2,2,0]),
  // Elixir Soup
  f("Elixir Soup","Soupe √âlixir","Drink","Fire",
    [0,0,-1,0,2,0,2,0,0,2],
    [2,0,0,0,2,0,2,0,-2,5],
    [2,0,2,0,5,2,5,-2,-5,10]),
  // Great Fairy's Tears
  f("Great Fairy's Tears","Larmes de la grande f√©e","Drink","Light",
    [0,2,0,0,0,2,2,0,-1,0],
    [0,5,2,0,-2,5,2,0,0,0],
    [-2,5,2,0,-5,10,5,-2,2,0]),
  // Chateau Romani
  f("Chateau Romani","Ch√¢teau Romani","Drink","Light",
    [0,0,2,0,2,0,0,2,-1,0],
    [0,2,5,-2,5,0,0,2,0,0],
    [0,2,10,-5,5,-2,-2,5,2,0]),
  // Bottled Water
  f("Bottled Water","Eau en bouteille","Drink","Water",
    [0,2,-1,0,2,0,0,2,0,0],
    [0,5,0,0,5,-2,0,2,2,0],
    [-2,5,2,0,10,-5,-2,5,2,0]),
  // Hot Spring Water
  f("Hot Spring Water","Eau thermale","Drink","Fire",
    [0,2,0,0,-1,0,0,2,2,0],
    [2,5,2,0,0,0,0,2,5,0],
    [-5,10,2,0,2,0,-2,5,5,-2]),

  // ===== PLANTS / SEEDS =====
  // Odd Mushroom
  f("Odd Mushroom","Champignon √©trange","Plant","Darkness",
    [0,0,2,0,2,0,2,0,-1,0],
    [2,0,5,-2,2,0,5,0,0,0],
    [2,0,10,-5,5,-2,5,-2,2,0]),
  // Deku Nut
  f("Deku Nut","Noix Mojo","Plant","Light",
    [1,0,2,0,2,0,2,0,0,0],
    [0,0,5,0,5,-2,2,0,2,0],
    [2,0,5,-2,10,-5,5,-2,2,0]),
  // Magic Beans
  f("Magic Beans","Haricots magiques","Plant","Light",
    [2,0,-1,0,2,0,0,0,2,0],
    [5,0,0,0,5,-2,2,0,2,0],
    [5,-2,2,0,10,-5,2,0,5,-2]),
  // Life Tree Fruit
  f("Life Tree Fruit","Fruit de l‚ÄôArbre de vie","Plant","Light",
    [0,0,0,-1,2,0,2,0,2,0],
    [2,0,0,0,5,-2,5,0,2,0],
    [2,0,0,2,10,-5,5,-2,5,-2]),
  // Light Fruit
  f("Light Fruit","Fruit de lumi√®re","Plant","Light",
    [2,0,0,-1,2,0,0,0,2,0],
    [5,-2,0,0,5,0,2,0,2,0],
    [10,-5,0,2,5,-2,2,0,5,-2]),
  // Stamina Fruit
  f("Stamina Fruit","Fruit d‚Äôendurance","Plant","Lightning",
    [2,0,0,0,-1,0,2,0,2,0],
    [5,0,0,2,0,0,5,-2,2,0],
    [5,-2,0,2,2,0,10,-5,5,-2]),
  // Water Fruit
  f("Water Fruit","Fruit d‚Äôeau","Plant","Water",
    [-1,0,0,2,2,0,2,0,0,0],
    [0,0,0,5,2,0,5,-2,2,0],
    [2,0,-2,5,5,-2,10,-5,2,0]),
  // Hyoi Pear
  f("Hyoi Pear","Poire mojo","Plant","Wind",
    [-1,0,2,0,2,0,0,0,0,2],
    [0,0,5,0,2,0,2,0,-2,5],
    [2,0,5,-2,5,-2,2,0,-5,10]),
  // Carrot
  f("Carrot","Carotte","Plant","Lightning",
    [-1,0,2,0,0,0,0,2,0,2],
    [0,0,2,0,2,0,-2,5,0,5],
    [2,0,5,-2,2,0,-5,10,-2,5]),
  // Ember Seeds
  f("Ember Seeds","Graines braise","Plant","Fire",
    [0,0,2,0,-1,0,0,2,2,0],
    [0,2,5,-2,0,0,2,5,0,0],
    [0,2,10,-5,2,0,-2,5,5,-2]),
  // Scent Seeds
  f("Scent Seeds","Graines parfum√©es","Plant","Darkness",
    [0,0,2,0,2,0,0,2,-1,0],
    [0,2,5,0,2,0,-2,5,0,0],
    [0,2,5,-2,5,-2,-5,10,2,0]),
  // Pegasus Seeds
  f("Pegasus Seeds","Graines P√©gase","Plant","Lightning",
    [0,-1,0,0,2,0,0,2,2,0],
    [0,0,2,0,2,0,-2,5,5,0],
    [0,2,2,0,5,-2,-5,10,5,-2]),
  // Gale Seeds
  f("Gale Seeds","Graines ouragan","Plant","Wind",
    [0,2,2,0,2,0,0,0,-1,0],
    [0,2,5,-2,5,0,0,2,0,0],
    [-2,5,10,-5,5,-2,0,2,2,0]),
  // Mystery Seeds
  f("Mystery Seeds","Graines myst√®re","Plant","Light",
    [0,2,2,0,2,0,0,-1,0,0],
    [0,5,2,0,5,-2,0,0,2,0],
    [-2,5,5,-2,10,-5,0,2,2,0]),
  // Pumpkin
  f("Pumpkin","Citrouille","Plant","Earth",
    [-1,0,0,0,2,0,2,0,2,0],
    [0,0,0,2,2,0,2,0,5,-2],
    [2,0,0,2,5,-2,5,-2,10,-5]),

  // ===== FISH =====
  // Greengill
  f("Greengill","Vertelette","Fish","Water",
    [0,0,-1,0,0,2,2,0,2,0],
    [0,2,0,0,-2,5,2,0,5,0],
    [0,2,2,0,-5,10,5,-2,5,-2]),
  // Ordon Catfish
  f("Ordon Catfish","Silure d‚ÄôOrdon","Fish","Water",
    [0,2,2,0,0,2,-1,0,0,0],
    [-2,5,5,0,0,2,0,0,2,0],
    [-5,10,5,-2,-2,5,2,0,2,0]),
  // Hyrule Bass
  f("Hyrule Bass","Perche d‚ÄôHyrule","Fish","Water",
    [0,2,2,0,0,0,2,0,-1,0],
    [-2,5,2,0,0,2,5,0,0,0],
    [-5,10,5,-2,0,2,5,-2,2,0]),
  // Hylian Pike
  f("Hylian Pike","Brochet d‚ÄôHyrule","Fish","Water",
    [0,2,0,0,0,-1,2,0,2,0],
    [0,2,2,0,0,0,5,-2,5,0],
    [-2,5,2,0,0,2,10,-5,5,-2]),
  // Reekfish
  f("Reekfish","Poisson-puant","Fish","Water",
    [0,2,2,0,0,-1,2,0,0,0],
    [0,2,5,-2,0,0,5,0,2,0],
    [-2,5,10,-5,0,2,5,-2,2,0]),
  // Hylian Loach
  f("Hylian Loach","Loche d‚ÄôHyrule","Fish","Water",
    [0,2,-1,0,0,2,0,0,2,0],
    [0,2,0,0,0,5,2,0,5,-2],
    [-2,5,2,0,-2,5,2,0,10,-5]),

  // ===== WEIRD (no Gratitude Crystals) =====
  // Mushroom Spores
  f("Mushroom Spores","Spores de champignon","Weird","Darkness",
    [2,0,0,2,2,0,-1,0,0,0],
    [5,-2,0,2,5,0,0,0,2,0],
    [10,-5,-2,5,5,-2,2,0,2,0]),
  // Skullfish
  f("Skullfish","Poisson-squelette","Weird","Darkness",
    [0,-1,2,0,0,2,2,0,0,0],
    [0,0,5,-2,0,2,5,0,2,0],
    [0,2,10,-5,-2,5,5,-2,2,0]),
  // Bombfish
  f("Bombfish","Poisson-bombe","Weird","Fire",
    [0,-1,2,0,0,2,0,2,0,0],
    [0,0,5,0,0,2,2,0,5,-2],
    [0,2,5,-2,0,2,5,-2,10,-5]),
  // Chu Jelly
  f("Chu Jelly","Gel√©e Chu","Weird","Darkness",
    [0,2,2,0,0,-1,2,0,0,0],
    [0,5,2,0,0,0,5,-2,2,0],
    [-2,5,5,-2,0,2,10,-5,2,0]),
  // Bee Larvae
  f("Bee Larvae","Larves d‚Äôabeille","Weird","Earth",
    [0,0,2,0,0,-1,2,0,2,0],
    [0,2,5,0,0,0,2,0,5,-2],
    [0,2,5,-2,0,2,5,-2,10,-5]),
  // Rock Sirloin
  f("Rock Sirloin","Viande de roc","Weird","Earth",
    [0,-1,2,0,0,0,2,2,0,0],
    [0,0,5,0,2,0,-2,5,2,0],
    [0,2,5,-2,2,0,-5,10,5,-2]),
];

// helper to expand three rarity rows into three entries
function f(baseEN, baseFR, type, element, bronze, silver, gold) {
  return [
    mk(baseEN, baseFR, type, element, "bronze", bronze),
    mk("Tasty " + baseEN, tastyFR(baseFR), type, element, "silver", silver),
    mk("Delicious " + baseEN, deliciousFR(baseFR), type, element, "gold", gold),
  ];
}
function mk(nameEN, nameFR, type, element, rarity, arr) {
  const key = nameEN.toLowerCase().replace(/[^a-z0-9]+/g,"-")+"-"+rarity;
  const traits = {};
  TRAITS.forEach((t,i)=>traits[t] = arr[i] || 0);
  const rarity_label_en =
    rarity === "bronze" ? "bronze" :
    rarity === "silver" ? "Tasty (silver)" :
    "Delicious (gold)";
  const rarity_label_fr =
    rarity === "bronze" ? "bronze" :
    rarity === "silver" ? "Savoureux (argent)" :
    "D√©licieux (or)";
  return {
    key,
    base: nameEN.replace(/^Tasty |^Delicious /,""),
    name_en: nameEN,
    name_fr: nameFR,
    rarity,
    rarity_label_en,
    rarity_label_fr,
    type,
    element,
    traits
  };
}
function tastyFR(baseFR) {
  // very lightweight gender handling; tweak manually where needed
  if (baseFR.match(/euse$|ice$|ette$|ille$|ion$|√©e$|ie$|ure$|ouffe$/i)) {
    return baseFR + " savoureuse";
  }
  if (baseFR.match(/e$|ue$|ille$|une$|soupe$/i)) {
    return baseFR + " savoureuse";
  }
  return baseFR + " savoureux";
}
function deliciousFR(baseFR) {
  if (baseFR.match(/euse$|ice$|ette$|ille$|ion$|√©e$|ie$|ure$|ouffe$/i)) {
    return baseFR + " exquise";
  }
  if (baseFR.match(/e$|ue$|ille$|une$|soupe$/i)) {
    return baseFR + " exquise";
  }
  return baseFR + " exquis";
}

// flatten FOODS helper
const ALL_FOODS = FOODS.flat();

// --- UI wiring ---

const langSelect = document.getElementById("lang");
const personalitiesDiv = document.getElementById("personalities");
const skillsDiv = document.getElementById("skills");
const planBtn = document.getElementById("plan-btn");
const planOut = document.getElementById("plan-output");
const planWarn = document.getElementById("plan-warning");

let currentLang = "en";
const selectedPersonalities = new Set();
const targetTraits = new Set(TRAITS); // all on by default

function renderPersonalities() {
  personalitiesDiv.innerHTML = "";
  PERSONALITY_DEF.forEach(p => {
    const btn = document.createElement("div");
    btn.className = "personality";
    btn.dataset.trait = p.trait;
    btn.textContent = currentLang === "en" ? p.en : p.fr;
    btn.onclick = () => {
      const tr = p.trait;
      if (selectedPersonalities.has(tr)) {
        selectedPersonalities.delete(tr);
        btn.classList.remove("selected");
      } else {
        selectedPersonalities.add(tr);
        btn.classList.add("selected");
      }
    };
    personalitiesDiv.appendChild(btn);
  });
}

function renderSkills() {
  skillsDiv.innerHTML = "";
  TRAITS.forEach(tr => {
    const label = document.createElement("label");
    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.checked = targetTraits.has(tr);
    cb.onchange = () => {
      if (cb.checked) targetTraits.add(tr);
      else targetTraits.delete(tr);
    };
    const span = document.createElement("span");
    span.textContent = tr;
    label.appendChild(cb);
    label.appendChild(span);
    skillsDiv.appendChild(label);
  });
}

function updateTexts() {
  const isFR = currentLang === "fr";
  document.getElementById("lang-label").textContent = isFR ? "Langue" : "Language";
  document.getElementById("subtitle").textContent =
    isFR
      ? "Planifiez les repas pour que votre f√©e atteigne tous les traits n√©cessaires aux comp√©tences."
      : "Plan what to feed your fairy so she reaches all traits needed for every School skill.";
  document.getElementById("start-title").textContent =
    isFR ? "Personnalit√©s de d√©part" : "Starting personalities";
  document.getElementById("start-help").textContent =
    isFR
      ? "Touchez les personnalit√©s d√©j√† pr√©sentes sur votre f√©e. Cela ajuste l√©g√®rement les suggestions."
      : "Tap the personalities your fairy already has. This slightly nudges the suggestions.";
  document.getElementById("skills-title").textContent =
    isFR ? "Traits pour les comp√©tences" : "Target skill traits";
  document.getElementById("skills-help").textContent =
    isFR
      ? "Ces 10 traits servent aux comp√©tences de l‚Äô√âcole. Laissez tout coch√© pour viser toutes les comp√©tences."
      : "These 10 traits are used for School skills. Leave all checked to aim for every skill.";
  document.getElementById("plan-title").textContent =
    isFR ? "Plan d‚Äôalimentation" : "Feeding plan";
  document.getElementById("plan-help").textContent =
    isFR
      ? "Suggestion simple avec raret√© claire (bronze / Savoureux / D√©licieux) selon les valeurs du guide."
      : "Simple suggestion with clear rarity (bronze / Tasty / Delicious) based on the guide values.";
  document.getElementById("plan-btn-label").textContent =
    isFR ? "Proposer des repas" : "Suggest foods";
}

langSelect.onchange = () => {
  currentLang = langSelect.value;
  updateTexts();
  renderPersonalities();
};

renderPersonalities();
renderSkills();
updateTexts();

// --- Planning logic (simple & transparent) ---
// Goal: for each selected trait, reach a threshold sum using as few foods as possible.
// This is a helper, not frame-perfect optimization, but good enough for planning.

planBtn.onclick = () => {
  const neededTraits = Array.from(targetTraits);
  if (!neededTraits.length) {
    planOut.textContent = currentLang === "fr"
      ? "Choisissez au moins un trait √† viser."
      : "Select at least one trait to target.";
    planWarn.textContent = "";
    return;
  }

  // baseline: tiny bias for selected personalities (they're already strong)
  const baseline = {};
  TRAITS.forEach(t => baseline[t] = 0);
  selectedPersonalities.forEach(t => baseline[t] += 3);

  // naive target: want at least 30 in each chosen trait (adjustable)
  const TARGET = 30;

  // greedy pick: repeatedly choose the food with best score toward deficits
  const plan = [];
  const current = { ...baseline };

  function bestFood() {
    let best = null;
    let bestScore = 0;
    for (const food of ALL_FOODS) {
      // skip if this food overall pushes too many chosen traits negative
      let score = 0;
      for (const tr of neededTraits) {
        const delta = food.traits[tr] || 0;
        const deficit = Math.max(0, TARGET - current[tr]);
        if (deficit > 0 && delta > 0) {
          score += delta;
        }
        if (deficit > 0 && delta < 0) {
          score += delta * 0.6; // soft penalty
        }
      }
      if (score > bestScore + 0.0001) {
        bestScore = score;
        best = food;
      }
    }
    return bestScore > 0 ? best : null;
  }

  // limit steps so it doesn't spam
  for (let i = 0; i < 60; i++) {
    const done = neededTraits.every(tr => current[tr] >= TARGET);
    if (done) break;
    const food = bestFood();
    if (!food) break;
    plan.push(food);
    TRAITS.forEach(tr => {
      current[tr] += (food.traits[tr] || 0);
    });
  }

  // format output
  if (!plan.length) {
    planOut.textContent = currentLang === "fr"
      ? "Aucune suggestion trouv√©e avec les param√®tres actuels."
      : "No usable suggestion found with the current settings.";
    planWarn.textContent = "";
    return;
  }

  // compress identical foods
  const countMap = {};
  for (const f of plan) {
    const code = f.key;
    if (!countMap[code]) countMap[code] = { food: f, n: 0 };
    countMap[code].n++;
  }

  const lines = [];
  for (const {food, n} of Object.values(countMap)) {
    const name = currentLang === "fr" ? food.name_fr : food.name_en;
    const rarityLabel = currentLang === "fr"
      ? food.rarity_label_fr
      : food.rarity_label_en;
    lines.push(
      `‚Ä¢ x${n} ${name} [${rarityLabel}, ${food.type}, ${food.element}]`
    );
  }

  planOut.innerHTML = lines.map(l => `<div class="food-line">${l}</div>`).join("");

  const missing = neededTraits.filter(tr => current[tr] < TARGET);
  if (missing.length) {
    planWarn.textContent = (currentLang === "fr"
      ? "Remarque : ces traits restent un peu bas, ajustez manuellement avec vos stocks : "
      : "Note: these traits still look low, tweak manually with your own stock: "
    ) + missing.join(", ");
  } else {
    planWarn.textContent = currentLang === "fr"
      ? "Tous les traits cibl√©s atteignent ou approchent le seuil recommand√©. Ajustez selon vos vrais stocks."
      : "All selected traits reach or approach the recommended threshold. Adjust based on your real inventory.";
  }
};
</script>
</body>
</html>
