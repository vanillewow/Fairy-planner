<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Fairy Planner – HWDE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050816;
      --card: #0c1220;
      --accent: #4fd1c5;
      --accent-soft: rgba(79,209,197,0.16);
      --accent-alt: #f6e05e;
      --danger: #f56565;
      --text: #f7fafc;
      --muted: #a0aec0;
      --radius: 14px;
      --shadow: 0 14px 32px rgba(0,0,0,0.7);
      --gap: 10px;
      --font: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
              -system-ui, sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 12px;
      font-family: var(--font);
      background: radial-gradient(circle at top left, #111827, #050816 55%);
      color: var(--text);
    }

    h1 {
      font-size: 22px;
      margin: 4px 0 2px;
    }

    h2 {
      font-size: 17px;
      margin: 14px 0 6px;
    }

    h3 {
      font-size: 15px;
      margin: 10px 0 4px;
    }

    small {
      color: var(--muted);
      font-size: 11px;
    }

    .app {
      max-width: 900px;
      margin: 0 auto 40px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: var(--gap);
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 10px 10px 8px;
      margin-bottom: 10px;
      border: 1px solid rgba(148,163,253,0.16);
    }

    .lang-toggle,
    .pill-row,
    .settings-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .lang-btn {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      background: transparent;
      color: var(--accent);
      font-size: 11px;
      cursor: pointer;
    }

    .lang-btn.active {
      background: var(--accent);
      color: #020817;
      font-weight: 600;
    }

    label {
      font-size: 11px;
      color: var(--muted);
    }

    select,
    input[type="number"] {
      padding: 4px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,253,0.22);
      background: #020817;
      color: var(--text);
      font-size: 11px;
      outline: none;
      min-width: 0;
    }

    .pill {
      padding: 4px 9px;
      font-size: 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,253,0.35);
      color: var(--muted);
      cursor: pointer;
      user-select: none;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .pill span.key {
      font-size: 9px;
      color: rgba(156,163,175,0.9);
    }

    .pill.active {
      background: var(--accent-soft);
      color: var(--accent-alt);
      border-color: var(--accent);
      font-weight: 600;
    }

    .pill.active span.key {
      color: var(--accent);
    }

    button.primary {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(90deg, var(--accent), var(--accent-alt));
      color: #020817;
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
    }

    .tips {
      font-size: 10px;
      color: var(--muted);
      margin-top: 2px;
    }

    .results {
      font-size: 11px;
      line-height: 1.5;
    }

    .trait-block {
      margin-bottom: 10px;
      padding: 6px;
      border-radius: 10px;
      background: rgba(15,23,42,0.96);
    }

    .trait-title {
      font-weight: 600;
      font-size: 11px;
      color: var(--accent-alt);
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    .food-line {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      margin-top: 1px;
    }

    .food-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .food-delta {
      text-align: right;
      white-space: nowrap;
    }

    .neg {
      color: var(--danger);
    }

    @media (min-width: 720px) {
      h1 { font-size: 24px; }
      .card { padding: 12px 12px 10px; }
      button.primary { width: auto; padding-inline: 14px; }
    }
  </style>
</head>
<body>
<div class="app">
  <div class="card">
    <div class="row" style="justify-content:space-between;align-items:flex-end;">
      <div>
        <h1>My Fairy Planner</h1>
        <small>Hyrule Warriors: Definitive Edition – Fairy food helper</small>
      </div>
      <div class="lang-toggle">
        <button class="lang-btn active" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="fr">FR</button>
      </div>
    </div>
  </div>

  <!-- Fairy settings -->
  <div class="card">
    <h2 data-i="settingsTitle">Fairy setup</h2>
    <div class="settings-row" style="margin-bottom:6px;">
      <div>
        <label data-i="elementLabel">Element</label><br/>
        <select id="fairy-element">
          <option value="fire">Fire</option>
          <option value="water">Water</option>
          <option value="lightning">Lightning</option>
          <option value="light">Light</option>
          <option value="dark">Darkness</option>
        </select>
      </div>
      <div>
        <label data-i="levelLabel">Starting level</label><br/>
        <input id="fairy-level" type="number" min="1" max="99" value="1"/>
      </div>
    </div>
    <div>
      <label data-i="startTraitsLabel">Starting personalities</label>
      <div id="trait-pills" class="pill-row"></div>
      <div class="tips" data-i="startTraitsHint">
        Tap to toggle which personality traits your fairy already has.
        This only affects how suggestions are ranked.
      </div>
    </div>
  </div>

  <!-- Planner -->
  <div class="card">
    <h2 data-i="plannerTitle">Recommended foods</h2>
    <p class="tips" data-i="plannerHint">
      Based on your fairy's element, this lists the most efficient foods (by rarity)
      to raise each personality while avoiding harsh penalties. Matching-element
      foods get the in-game bonus to trait gains.
    </p>
    <button class="primary" id="plan-btn" data-i="planBtn">
      Show best foods per personality
    </button>
    <div id="results" class="results" style="margin-top:6px;"></div>
  </div>

  <div class="card">
    <h3 data-i="notesTitle">Notes</h3>
    <ul class="tips" style="padding-left:18px;margin-top:4px;">
      <li data-i="note1">
        Trait effects & food values are taken from the GameFAQs “My Fairy Unlockables”
        table and related resources; if you spot a typo, you can edit the numbers
        in the <code>FOODS</code> list in this file.
      </li>
      <li data-i="note2">
        Bronze foods count as 1 level, Silver as 2, Gold as 3. Element-matching
        bonus is applied when scoring foods.
      </li>
      <li data-i="note3">
        Gratitude Crystals are intentionally excluded.
      </li>
    </ul>
  </div>
</div>

<script>
/*
  Core data & labels
  ------------------
  Traits order follows the GameFAQs table:
  Sparkly, Relaxed, Valiant, Dizzy, Friendly,
  Aspiring, Resolute, Shrewd, Eager, Smiley
*/

const TRAITS = [
  "Sparkly", "Relaxed", "Valiant", "Dizzy", "Friendly",
  "Aspiring", "Resolute", "Shrewd", "Eager", "Smiley"
];

// In-game FR ↔ EN labels as per your screenshot.
const TRAIT_LABELS = {
  Sparkly: { en: "Sparkly",              fr: "Vivacité" },
  Relaxed: { en: "Relaxed / Soft",      fr: "Esquive" },
  Valiant: { en: "Valiant / Flashy",    fr: "Classe" },
  Dizzy:   { en: "Dizzy",                fr: "Volupté" },
  Friendly:{ en: "Friendly",             fr: "Franchise" },
  Aspiring:{ en: "Aspiring / Dreamy",   fr: "Admiration" },
  Resolute:{ en: "Resolute",             fr: "Endurance" },
  Shrewd:  { en: "Esquive / Fleet",     fr: "Acrobatie" },
  Eager:   { en: "Eager",                fr: "Passion" },
  Smiley:  { en: "Smiley",               fr: "Gaieté" }
};

// Simple UI translations (not literal; uses in-game wording)
const I18N = {
  en: {
    settingsTitle: "Fairy setup",
    elementLabel: "Element",
    levelLabel: "Starting level",
    startTraitsLabel: "Starting personalities",
    startTraitsHint:
      "Tap to toggle which personality traits your fairy starts with. This slightly boosts foods that match them.",
    plannerTitle: "Recommended foods",
    plannerHint:
      "Click the button to see, for each personality, which foods (by rarity) are best for raising it on your chosen fairy.",
    planBtn: "Show best foods per personality",
    notesTitle: "Notes",
    note1:
      "Trait changes are based on the GameFAQs \"My Fairy Unlockables\" table. If anything looks off, tweak it directly in the FOODS list.",
    note2:
      "Bronze = 1 level, Silver = 2, Gold = 3. Matching-element foods get the in-game bonus to their personality effects.",
    note3:
      "Gratitude Crystals are excluded on purpose."
  },
  fr: {
    settingsTitle: "Configuration de la fée",
    elementLabel: "Élément",
    levelLabel: "Niveau de départ",
    startTraitsLabel: "Personnalités de départ",
    startTraitsHint:
      "Touchez pour indiquer les traits que la fée possède déjà. Les recommandations privilégient ces traits.",
    plannerTitle: "Nourriture recommandée",
    plannerHint:
      "Appuyez pour afficher, pour chaque personnalité, les meilleurs aliments (par rareté) pour la développer avec cette fée.",
    planBtn: "Afficher les meilleurs aliments par personnalité",
    notesTitle: "Remarques",
    note1:
      "Les valeurs viennent du tableau \"My Fairy Unlockables\" sur GameFAQs. Si un chiffre est incorrect, modifiez-le dans la liste FOODS.",
    note2:
      "Bronze = 1 niveau, Argent = 2, Or = 3. Les aliments du même élément que la fée reçoivent le bonus en jeu.",
    note3:
      "Les cristaux de gratitude sont volontairement exclus."
  }
};

let currentLang = "en";

// Element bonus mapping (Mini Guide rules)
function applyElementBonus(element, foodElement, traits) {
  if (!foodElement || foodElement !== element) return traits.slice();
  const map = {
    "-5": -2,
    "-2": +1,
    "-1": +2,
    "+2": +3,
    "+5": +6,
    "+10": +12
  };
  return traits.map(v => {
    if (v === 0) return 0;
    const key = (v > 0 ? "+" : "") + v;
    return (key in map) ? map[key] : v;
  });
}

/*
  FOOD DATA
  ---------
  For each base food: three entries (bronze / Tasty / Delicious) with:
  - name_en, name_fr (in-game style)
  - rarity: "bronze" | "silver" | "gold"
  - element: "fire"|"water"|"lightning"|"light"|"dark"
  - traits: [10 numbers in TRAITS order]
  Values adapted from GameFAQs My Fairy Unlockables table.
*/

const FOODS = [];

// helper
function addFoodSet(opts) {
  const {
    baseId,
    names_en, names_fr,
    element,
    rows // [bronze, silver, gold] trait arrays
  } = opts;
  const rarities = [
    { key: "bronze",  lv: 1 },
    { key: "silver",  lv: 2 },
    { key: "gold",    lv: 3 }
  ];
  rarities.forEach((r, idx) => {
    FOODS.push({
      id: baseId + "-" + r.key,
      name_en: names_en[idx],
      name_fr: names_fr[idx],
      rarity: r.key,
      levels: r.lv,
      element,
      traits: rows[idx]
    });
  });
}

/* === FEASTS === */
addFoodSet({
  baseId: "weird-egg",
  names_en: ["Weird Egg","Tasty Weird Egg","Delicious Weird Egg"],
  names_fr: ["Œuf étrange","Œuf étrange savoureux","Œuf étrange exquis"],
  element: "light",
  rows: [
    [ 2,  0,  2,  0, -1,  0,  2,  0,  0,  0],
    [ 5, -2,  2,  0,  0,  0,  5,  0,  2,  0],
    [10, -5,  5, -2,  2,  0,  5, -2,  2,  0]
  ]
});

addFoodSet({
  baseId: "all-purpose-bait",
  names_en: ["All-Purpose Bait","Tasty All-Purpose Bait","Delicious All-Purpose Bait"],
  names_fr: ["Appât universel","Appât universel savoureux","Appât universel exquis"],
  element: "light",
  rows: [
    [ 0,  0, -1, 0,  0,  2,  0,  0,  2,  0],
    [ 2,  0,  0, 0,  5,  0,  2,  0, -2, 5],
    [ 2,  0,  2, 0,  5, -2, 5, -2, -5,10]
  ]
});

addFoodSet({
  baseId: "ordon-goat-cheese",
  names_en: ["Ordon Goat Cheese","Tasty Ordon Goat Cheese","Delicious Ordon Goat Cheese"],
  names_fr: ["Fromage de chèvre d'Ordon","Fromage de chèvre d'Ordon savoureux","Fromage de chèvre d'Ordon exquis"],
  element: "dark",
  rows: [
    [ 0,  2,  2,  0, 0, 0,  2,  0, -1, 0],
    [ 0,  2,  5,-2, 2, 5,  0,  0,  0, 0],
    [-2,  5, 10,-5, 0, 5, -2, 2,  0, 0]
  ]
});

addFoodSet({
  baseId: "meat",
  names_en: ["Meat","Tasty Meat","Delicious Meat"],
  names_fr: ["Viande","Viande savoureuse","Viande exquise"],
  element: "fire",
  rows: [
    [ 0, -1, 2, 0, 0, 0, 2, 2, 0, 0],
    [ 0,  0, 5,-2,0, 0, 5, 2, 0, 0],
    [ 0,  2,10,-5,2, 0, 5, 5,-2,0]
  ]
});

/* === DRINKS === */
addFoodSet({
  baseId: "lon-lon-milk",
  names_en: ["Lon Lon Milk","Tasty Lon Lon Milk","Delicious Lon Lon Milk"],
  names_fr: ["Lait de Lon Lon","Lait de Lon Lon savoureux","Lait de Lon Lon exquis"],
  element: "light",
  rows: [
    [ 2,  0,-1, 0,0, 2, 0, 2, 0,0],
    [ 2,  0, 0, 0,2, 0, 5,-2,5,0],
    [ 5, -2,2, 0,2, 0,10,-5,5,-2]
  ]
});

addFoodSet({
  baseId: "pumpkin-soup",
  names_en: ["Pumpkin Soup","Tasty Pumpkin Soup","Delicious Pumpkin Soup"],
  names_fr: ["Soupe à la citrouille","Soupe à la citrouille savoureuse","Soupe à la citrouille exquise"],
  element: "fire",
  rows: [
    [ 0, 0, -1,2,0,2,0,2,0,0],
    [ 2, 0, 0,0,2,0,5,-2,5,0],
    [ 2, 0, 0,2,5,-2,10,-5,5,-2]
  ]
});

addFoodSet({
  baseId: "sacred-water",
  names_en: ["Sacred Water","Tasty Sacred Water","Delicious Sacred Water"],
  names_fr: ["Eau sacrée","Eau sacrée savoureuse","Eau sacrée exquise"],
  element: "water",
  rows: [
    [ 2, 0,-1,2,0,2,0,0,0,0],
    [ 5,-2,0,5,0,2,0,2,0,0],
    [10,-5,0,2,5,-2,2,0,0,0]
  ]
});

addFoodSet({
  baseId: "elixir-soup",
  names_en: ["Elixir Soup","Tasty Elixir Soup","Delicious Elixir Soup"],
  names_fr: ["Soupe Élixir","Soupe Élixir savoureuse","Soupe Élixir exquise"],
  element: "light",
  rows: [
    [ 0, 0,-1,2,0,2,0,0,2,0],
    [ 2, 0, 0,0,2,0,2,0,-2,5],
    [ 2, 0, 2,0,5,2,5,-2,-5,10]
  ]
});

addFoodSet({
  baseId: "great-fairy-tears",
  names_en: ["Great Fairy's Tears","Tasty Great Fairy's Tears","Delicious Great Fairy's Tears"],
  names_fr: ["Larmes de la grande fée","Larmes de la grande fée savoureuses","Larmes de la grande fée exquises"],
  element: "light",
  rows: [
    [ 0, 2,0,0,0,2,2,0,-1,0],
    [ 0, 5,2,0,-2,5,2,0, 0,0],
    [-2, 5,2,0,-5,10,5,-2,2,0]
  ]
});

addFoodSet({
  baseId: "chateau-romani",
  names_en: ["Chateau Romani","Tasty Chateau Romani","Delicious Chateau Romani"],
  names_fr: ["Château Romani","Château Romani savoureux","Château Romani exquis"],
  element: "light",
  rows: [
    [ 0, 0,2,0,2,0,0,2,-1,0],
    [ 0, 2,5,-2,5,0,0,2, 0,0],
    [ 0, 2,10,-5,5,-2,-2,5,2,0]
  ]
});

addFoodSet({
  baseId: "bottled-water",
  names_en: ["Bottled Water","Tasty Bottled Water","Delicious Bottled Water"],
  names_fr: ["Eau en bouteille","Eau en bouteille savoureuse","Eau en bouteille exquise"],
  element: "water",
  rows: [
    [ 0, 2,-1,2,0,0,2,0,0,0],
    [ 0, 5,0,0,5,-2,0,2,2,0],
    [-2, 5,2,0,10,-5,-2,5,2,0]
  ]
});

addFoodSet({
  baseId: "hot-spring-water",
  names_en: ["Hot Spring Water","Tasty Hot Spring Water","Delicious Hot Spring Water"],
  names_fr: ["Eau thermale","Eau thermale savoureuse","Eau thermale exquise"],
  element: "water",
  rows: [
    [ 0, 2,0,0,-1,0,0,2,2,0],
    [ 2, 5,2,0, 0,0,0,2,5,0],
    [-5,10,2,0, 2,0,-2,5,5,-2]
  ]
});

/* === PLANTS, SEEDS, ETC. === */
/* (Only a selection shown here; structure matches table; you can extend) */

addFoodSet({
  baseId: "odd-mushroom",
  names_en: ["Odd Mushroom","Tasty Odd Mushroom","Delicious Odd Mushroom"],
  names_fr: ["Champignon étrange","Champignon étrange savoureux","Champignon étrange exquis"],
  element: "dark",
  rows: [
    [ 0, 0,2,0,2,0,2,0,-1,0],
    [ 2, 0,5,-2,2,0,5,0, 0,0],
    [ 2, 0,10,-5,5,-2,5,-2,2,0]
  ]
});

addFoodSet({
  baseId: "deku-nut",
  names_en: ["Deku Nut","Tasty Deku Nut","Delicious Deku Nut"],
  names_fr: ["Noix Mojo","Noix Mojo savoureuse","Noix Mojo exquise"],
  element: "lightning",
  rows: [
    [ 1, 0,2,0,2,0,2,0,0,0],
    [ 0, 0,5,0,5,-2,2,0,2,0],
    [ 2, 0,5,-2,10,-5,5,-2,2,0]
  ]
});

addFoodSet({
  baseId: "magic-beans",
  names_en: ["Magic Beans","Tasty Magic Beans","Delicious Magic Beans"],
  names_fr: ["Fèves magiques","Fèves magiques savoureuses","Fèves magiques exquises"],
  element: "light",
  rows: [
    [ 2, 0,-1,2,0,0,0,2,0,0],
    [ 5, 0,0,0,5,-2,2,0,2,0],
    [ 5,-2,2,0,10,-5,2,0,5,-2]
  ]
});

addFoodSet({
  baseId: "life-tree-fruit",
  names_en: ["Life Tree Fruit","Tasty Life Tree Fruit","Delicious Life Tree Fruit"],
  names_fr: ["Fruit de l'Arbre de vie","Fruit de l'Arbre de vie savoureux","Fruit de l'Arbre de vie exquis"],
  element: "light",
  rows: [
    [ 0,0,-1,2,0,2,0,2,0,0],
    [ 2,0,0,0,5,-2,5,0,2,0],
    [ 2,0,0,2,10,-5,5,-2,5,-2]
  ]
});

addFoodSet({
  baseId: "light-fruit",
  names_en: ["Light Fruit","Tasty Light Fruit","Delicious Light Fruit"],
  names_fr: ["Fruit de lumière","Fruit de lumière savoureux","Fruit de lumière exquis"],
  element: "light",
  rows: [
    [ 2,0,-1,2,0,0,0,0,2,0],
    [ 5,-2,0,0,5,0,2,0,2,0],
    [10,-5,0,2,5,-2,2,0,5,-2]
  ]
});

addFoodSet({
  baseId: "stamina-fruit",
  names_en: ["Stamina Fruit","Tasty Stamina Fruit","Delicious Stamina Fruit"],
  names_fr: ["Stamina fruit","Stamina fruit savoureux","Stamina fruit exquis"],
  element: "lightning",
  rows: [
    [ 2,0,0,0,-1,0,2,0,2,0],
    [ 5,0,0,2,0,0,5,-2,2,0],
    [ 5,-2,0,2,2,0,10,-5,5,-2]
  ]
});

addFoodSet({
  baseId: "water-fruit",
  names_en: ["Water Fruit","Tasty Water Fruit","Delicious Water Fruit"],
  names_fr: ["Fruit d'eau","Fruit d'eau savoureux","Fruit d'eau exquis"],
  element: "water",
  rows: [
    [-1,0,0,2,2,0,2,0,0,0],
    [ 0,0,0,5,2,0,5,-2,2,0],
    [ 2,0,-2,5,5,-2,10,-5,2,0]
  ]
});

/* ... (for brevity, remaining seeds / fish / weird items follow the same pattern.
   You can continue transcribing from the GameFAQs table into addFoodSet calls.
   The planner logic below works for all of them.)
*/

/* === UI: language + traits pills === */

const traitPillsContainer = document.getElementById("trait-pills");
const resultsEl = document.getElementById("results");

const activeStartTraits = new Set(); // trait keys

function renderTraitPills() {
  traitPillsContainer.innerHTML = "";
  TRAITS.forEach(key => {
    const pill = document.createElement("div");
    pill.className = "pill";
    const label = document.createElement("span");
    label.textContent = currentLang === "en"
      ? TRAIT_LABELS[key].en
      : TRAIT_LABELS[key].fr;
    const mini = document.createElement("span");
    mini.className = "key";
    mini.textContent = key;
    pill.appendChild(label);
    pill.appendChild(mini);

    if (activeStartTraits.has(key)) pill.classList.add("active");

    pill.onclick = () => {
      if (activeStartTraits.has(key)) {
        activeStartTraits.delete(key);
        pill.classList.remove("active");
      } else {
        activeStartTraits.add(key);
        pill.classList.add("active");
      }
    };

    traitPillsContainer.appendChild(pill);
  });
}

/* === Language handling === */

function applyLanguage() {
  document
    .querySelectorAll("[data-i]")
    .forEach(el => {
      const k = el.dataset.i;
      if (I18N[currentLang][k]) {
        el.textContent = I18N[currentLang][k];
      }
    });
  // Update element names in select
  const elSel = document.getElementById("fairy-element");
  if (currentLang === "fr") {
    elSel.options[0].text = "Feu";
    elSel.options[1].text = "Eau";
    elSel.options[2].text = "Foudre";
    elSel.options[3].text = "Lumière";
    elSel.options[4].text = "Ténèbres";
  } else {
    elSel.options[0].text = "Fire";
    elSel.options[1].text = "Water";
    elSel.options[2].text = "Lightning";
    elSel.options[3].text = "Light";
    elSel.options[4].text = "Darkness";
  }
  renderTraitPills();
}

document.querySelectorAll(".lang-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const lang = btn.dataset.lang;
    if (lang && lang !== currentLang) {
      currentLang = lang;
      document
        .querySelectorAll(".lang-btn")
        .forEach(b => b.classList.toggle("active", b === btn));
      applyLanguage();
    }
  });
});

/* === Planner logic === */

function scoreFoodForTrait(food, traitIndex, fairyElement) {
  // trait deltas with element bonus
  const adj = applyElementBonus(fairyElement, food.element, food.traits);
  const value = adj[traitIndex];

  if (value <= 0) return -9999; // we only want foods that help this trait

  // penalize negative impact on others
  let penalty = 0;
  for (let i = 0; i < adj.length; i++) {
    if (i === traitIndex) continue;
    if (adj[i] < 0) penalty += Math.abs(adj[i]) * 0.6;
  }

  // slight bonus if this trait is a starting personality
  const traitKey = TRAITS[traitIndex];
  const startBoost = activeStartTraits.has(traitKey) ? 1.15 : 1;

  // rarer foods are stronger but cost more levels; normalize a bit
  const levelCost = food.levels || 1;
  const efficiency = (value - penalty) / levelCost;

  return efficiency * startBoost;
}

function generatePlan() {
  const fairyElement = document.getElementById("fairy-element").value;
  const startLevel = Math.max(
    1,
    Math.min(99, parseInt(document.getElementById("fairy-level").value || "1",10))
  );

  const lang = currentLang;

  let html = "";

  TRAITS.forEach((traitKey, traitIndex) => {
    // sort foods by score desc
    const ranked = FOODS
      .map(f => ({
        food: f,
        score: scoreFoodForTrait(f, traitIndex, fairyElement),
        adj: applyElementBonus(fairyElement, f.element, f.traits)
      }))
      .filter(x => x.score > 0)
      .sort((a,b) => b.score - a.score)
      .slice(0, 6); // top 6 for brevity

    if (!ranked.length) return;

    const label = lang === "en"
      ? TRAIT_LABELS[traitKey].en
      : TRAIT_LABELS[traitKey].fr;

    html += `<div class="trait-block">`;
    html += `<div class="trait-title"><span>${label}</span>`;
    html += `<span>${traitKey}</span></div>`;

    ranked.forEach(({food, adj}) => {
      const delta = adj[traitIndex];
      const rarityLabel =
        food.rarity === "bronze"
          ? (lang==="en"?"Bronze":"Bronze")
          : food.rarity === "silver"
          ? (lang==="en"?"Silver / Tasty":"Argent / Savoureux")
          : (lang==="en"?"Gold / Delicious":"Or / Exquis");

      const name = lang === "en" ? food.name_en : food.name_fr;
      const tChange = delta > 0 ? `+${delta}` : delta;
      html += `<div class="food-line">
        <div class="food-name">${rarityLabel} – ${name}</div>
        <div class="food-delta">
          <span>${tChange}</span>
          <span style="margin-left:4px;">Lv+${food.levels}</span>
        </div>
      </div>`;
    });

    html += `</div>`;
  });

  resultsEl.innerHTML = html || (
    currentLang === "en"
      ? "<div class='tips'>No suggestions – check your data or settings.</div>"
      : "<div class='tips'>Aucune recommandation – vérifiez vos réglages ou les données.</div>"
  );
}

document.getElementById("plan-btn").addEventListener("click", generatePlan);

/* init */
renderTraitPills();
applyLanguage();
generatePlan();
</script>
</body>
</html>
