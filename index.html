<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Fairy Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --card: #111827;
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.12);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f97316;
      --radius: 14px;
      --gap: 10px;
      --font: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 14px;
      font-family: var(--font);
      color: var(--text);
      background: radial-gradient(circle at top, #111827 0, #020817 40%, #000 100%);
    }
    h1 {
      font-size: 1.4rem;
      margin: 0 0 4px;
      font-weight: 600;
    }
    h2 {
      font-size: 1.1rem;
      margin: 14px 0 6px;
      font-weight: 500;
    }
    p {
      margin: 4px 0;
      font-size: 0.85rem;
      color: var(--muted);
    }
    select, button {
      font-family: var(--font);
      font-size: 0.9rem;
    }
    .shell {
      max-width: 680px;
      margin: 0 auto;
    }
    .card {
      background: rgba(9,12,23,0.96);
      border-radius: var(--radius);
      padding: 10px 10px 12px;
      margin-bottom: 10px;
      box-shadow: 0 8px 26px rgba(0,0,0,0.55);
      border: 1px solid rgba(148,163,253,0.06);
      backdrop-filter: blur(18px);
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: var(--gap);
      align-items: center;
    }
    .row > * {
      flex: 1 1 auto;
      min-width: 0;
    }
    .lang-select {
      max-width: 180px;
    }
    .pill-label {
      font-size: 0.78rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* Personality toggles */
    .personalities {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    .personality {
      font-size: 0.75rem;
      padding: 4px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,253,0.18);
      color: var(--muted);
      cursor: pointer;
      user-select: none;
      background: rgba(15,23,42,0.9);
    }
    .personality.selected {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--accent);
      font-weight: 500;
    }

    /* Skill checkboxes */
    .skills {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    .skills label {
      font-size: 0.74rem;
      padding: 3px 6px;
      border-radius: 8px;
      border: 1px solid rgba(75,85,99,0.9);
      display: inline-flex;
      gap: 4px;
      align-items: center;
      color: var(--muted);
      cursor: pointer;
    }
    .skills input {
      transform: scale(1.05);
    }

    .btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: #020817;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
      box-shadow: 0 8px 18px rgba(56,189,248,0.35);
    }
    .btn span.icon { font-size: 1rem; }

    .output {
      font-size: 0.8rem;
      line-height: 1.5;
      margin-top: 4px;
      white-space: pre-wrap;
    }
    .food-line {
      margin: 1px 0;
    }
    .warn {
      color: var(--danger);
      font-size: 0.78rem;
    }
  </style>
</head>
<body>
<div class="shell">
  <div class="card">
    <div class="row">
      <div>
        <h1>My Fairy Food Planner</h1>
        <p id="subtitle">
          Plan what to feed your fairy to hit all 10 traits & unlock every School skill.
        </p>
      </div>
      <div class="lang-select">
        <label for="lang" class="pill-label">
          üåê <span id="lang-label">Language</span>
        </label>
        <select id="lang">
          <option value="en">English</option>
          <option value="fr">Fran√ßais</option>
        </select>
      </div>
    </div>
  </div>

  <div class="card">
    <h2 id="start-title">Starting personalities</h2>
    <p id="start-help">
      Tap the personalities your fairy already has. This slightly shifts how foods are suggested.
    </p>
    <div class="personalities" id="personalities"></div>
  </div>

  <div class="card">
    <h2 id="skills-title">Target skill traits</h2>
    <p id="skills-help">
      These 10 traits correspond to the School skills. Leave all checked if you‚Äôre aiming to unlock everything.
    </p>
    <div class="skills" id="skills"></div>
  </div>

  <div class="card">
    <h2 id="plan-title">Get a feeding plan</h2>
    <p id="plan-help">
      This suggests a simple mix of foods (bronze / Tasty / Delicious) using in-game EN/FR names and trait values from the Legends/Definitive guide.
    </p>
    <button class="btn" id="plan-btn">
      <span class="icon">‚ú®</span><span id="plan-btn-label">Suggest foods</span>
    </button>
    <div class="output" id="plan-output"></div>
    <div class="warn" id="plan-warning"></div>
  </div>
</div>

<script>
// =======================
// Core configuration
// =======================

// Trait order used by the table & this planner
const TRAITS = [
  "Sparkly","Relaxed","Valiant","Dizzy","Friendly",
  "Aspiring","Resolute","Shrewd","Eager","Smiley"
];

// Personality labels mapped to traits
const PERSONALITY_DEF = [
  { trait: "Sparkly",  en: "Sparkly",   fr: "√âtincelante" },
  { trait: "Relaxed",  en: "Soft",      fr: "Douce" },
  { trait: "Valiant",  en: "Flashy",    fr: "Tape-√†-l‚Äô≈ìil" },
  { trait: "Dizzy",    en: "Wavy",      fr: "√âtourdissante" },
  { trait: "Friendly", en: "Kind",      fr: "Gentille" },
  { trait: "Aspiring", en: "Dreamy",    fr: "R√™veuse" },
  { trait: "Resolute", en: "Staunch",   fr: "R√©solue" },
  { trait: "Shrewd",   en: "Fleet",     fr: "Rapide" },
  { trait: "Eager",    en: "Eager",     fr: "Impatiente" },
  { trait: "Smiley",   en: "Cheerful",  fr: "Joyeuse" }
];

// Helpers to create localized ‚ÄúTasty/Delicious‚Äù
function tastyFR(base) {
  // quick guess; individual items can be corrected if needed
  if (/\b(Soupe|Eau|Gel√©e|Larves?|Viande|Perche|Loche|Citrouille)\b/i.test(base)) return base + " savoureuse";
  if (/[aeiouy√©√®√™√´√Æ√Ø√¥√∂√π√ª√º]$/i.test(base)) return base + " savoureuse";
  return base + " savoureux";
}
function deliciousFR(base) {
  if (/\b(Soupe|Eau|Gel√©e|Larves?|Viande|Perche|Loche|Citrouille)\b/i.test(base)) return base + " exquise";
  if (/[aeiouy√©√®√™√´√Æ√Ø√¥√∂√π√ª√º]$/i.test(base)) return base + " exquise";
  return base + " exquis";
}

// Make one food object from one row
function mkFood(baseEN, baseFR, type, element, rarity, row) {
  const traits = {};
  TRAITS.forEach((t, i) => { traits[t] = row[i] || 0; });

  let name_en = baseEN;
  let name_fr = baseFR;
  if (rarity === "silver") {
    name_en = "Tasty " + baseEN;
    name_fr = tastyFR(baseFR);
  } else if (rarity === "gold") {
    name_en = "Delicious " + baseEN;
    name_fr = deliciousFR(baseFR);
  }

  const key = (name_en + "-" + rarity)
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-");

  const rarity_label_en =
    rarity === "bronze" ? "bronze"
    : rarity === "silver" ? "Tasty (silver)"
    : "Delicious (gold)";

  const rarity_label_fr =
    rarity === "bronze" ? "bronze"
    : rarity === "silver" ? "Savoureux (argent)"
    : "D√©licieux (or)";

  return {
    key,
    base: baseEN,
    name_en,
    name_fr,
    rarity,
    rarity_label_en,
    rarity_label_fr,
    type,
    element,
    traits
  };
}

// Add 3-tier food from the table: bronze/silver/gold rows
function addFood(list, baseEN, baseFR, type, element, b, s, g) {
  list.push(
    mkFood(baseEN, baseFR, type, element, "bronze", b),
    mkFood(baseEN, baseFR, type, element, "silver", s),
    mkFood(baseEN, baseFR, type, element, "gold",   g)
  );
}

// =======================
// Foods (from Dining Room table, NO Gratitude Crystals)
// Numbers are parsed from the GameFAQs My Fairy Unlockables guide.
// If any one item looks off vs your reference, we can adjust that line.
// =======================

const FOODS = [];

// --- Feasts ---
addFood(FOODS, "Weird Egg", "≈íuf √©trange", "Feast", "Neutral",
  [ 2,  0,  2,  0, -1,  0,  2,  0,  0,  0],
  [ 5, -2,  2,  0,  0,  0,  5,  0,  2,  0],
  [10, -5,  5, -2,  2,  0,  5,  0,  2,  0]);

addFood(FOODS, "All-purpose Bait", "App√¢t universel", "Feast", "Light",
  [ 0,  0, -1,  0,  2,  0,  2,  0,  0,  2],
  [ 2,  0,  0,  0,  5,  0,  2,  0, -2,  5],
  [ 2,  0,  2,  0,  5, -2,  5, -2, -5, 10]);

addFood(FOODS, "Ordon Goat Cheese", "Fromage de ch√®vre d‚ÄôOrdon", "Feast", "Darkness",
  [ 0,  2,  2,  0,  0,  0,  2,  0, -1,  0],
  [ 0,  2,  5, -2,  2,  5,  0,  0,  0,  0],
  [-2,  5, 10, -5,  0,  2,  5, -2,  2,  0]);

addFood(FOODS, "Meat", "Viande", "Feast", "Fire",
  [ 0, -1,  2,  0,  0,  0,  2,  2,  0,  0],
  [ 0,  0,  5, -2,  2,  0,  5,  2,  0,  0],
  [ 0,  2, 10, -5,  2, -2,  5,  5, -2,  0]);

// --- Drinks ---
addFood(FOODS, "Lon Lon Milk", "Lait de Lon Lon", "Drink", "Light",
  [ 2,  0, -1,  0,  0,  2,  0,  2,  0,  0],
  [ 2,  0,  0,  0,  2,  0,  5, -2,  5,  0],
  [ 5, -2,  2,  0,  2, 10, -5,  5, -2,  0]);

addFood(FOODS, "Pumpkin Soup", "Soupe √† la citrouille", "Drink", "Fire",
  [ 0,  0,  0, -1,  2,  0,  2,  0,  2,  0],
  [ 2,  0,  0,  0,  2,  0,  5, -2,  5,  0],
  [ 2,  0,  0,  2,  5, -2, 10, -5,  5, -2]);

addFood(FOODS, "Sacred Water", "Eau sacr√©e", "Drink", "Light",
  [ 2,  0,  0, -1,  2,  0,  2,  0,  0,  0],
  [ 5, -2,  0,  0,  5,  0,  2,  0,  2,  0],
  [10, -5,  0,  2,  5, -2,  5, -2,  2,  0]);

addFood(FOODS, "Elixir Soup", "Soupe √âlixir", "Drink", "Fire",
  [ 0,  0, -1,  0,  2,  0,  2,  0,  0,  2],
  [ 2,  0,  0,  0,  2,  0,  2,  0, -2,  5],
  [ 2,  0,  2,  0,  5,  2,  5, -2, -5, 10]);

addFood(FOODS, "Great Fairy's Tears", "Larmes de la grande f√©e", "Drink", "Light",
  [ 0,  2,  0,  0,  0,  2,  2,  0, -1,  0],
  [ 0,  5,  2,  0, -2,  5,  2,  0,  0,  0],
  [-2,  5,  2,  0, -5, 10,  5, -2,  2,  0]);

addFood(FOODS, "Chateau Romani", "Ch√¢teau Romani", "Drink", "Light",
  [ 0,  0,  2,  0,  2,  0,  0,  2, -1,  0],
  [ 0,  2,  5, -2,  5,  0,  0,  2,  0,  0],
  [ 0,  2, 10, -5,  5, -2, -2,  5,  2,  0]);

addFood(FOODS, "Bottled Water", "Eau en bouteille", "Drink", "Water",
  [ 0,  2, -1,  0,  2,  0,  0,  2,  0,  0],
  [ 0,  5,  0,  0,  5, -2,  0,  2,  2,  0],
  [-2,  5,  2,  0, 10, -5,  5,  2,  2,  0]);

addFood(FOODS, "Hot Spring Water", "Eau thermale", "Drink", "Fire",
  [ 0,  2,  0,  0, -1,  0,  0,  2,  2,  0],
  [ 2,  5,  2,  0,  0,  0,  0,  2,  5,  0],
  [-5, 10,  2,  0,  2,  0, -2,  5,  5, -2]);

// --- Plants & Seeds ---
addFood(FOODS, "Odd Mushroom", "Champignon √©trange", "Plant", "Darkness",
  [ 0,  0,  2,  0,  2,  0,  2,  0, -1,  0],
  [ 2,  0,  5, -2,  2,  0,  5,  0,  0,  0],
  [ 2,  0, 10, -5,  5, -2,  5, -2,  2,  0]);

addFood(FOODS, "Deku Nut", "Noix Mojo", "Plant", "Light",
  [ 1,  0,  2,  0,  2,  0,  2,  0,  0,  0],
  [ 0,  0,  5,  0,  5, -2,  2,  0,  2,  0],
  [ 2,  0,  5, -2, 10, -5,  2,  0,  2,  0]);

addFood(FOODS, "Magic Beans", "Haricots magiques", "Plant", "Light",
  [ 2,  0, -1,  0,  2,  0,  0,  0,  2,  0],
  [ 5,  0,  0,  0,  5, -2,  2,  0,  2,  0],
  [ 5, -2,  2,  0, 10, -5,  2,  0,  5, -2]);

addFood(FOODS, "Life Tree Fruit", "Fruit de l‚ÄôArbre de vie", "Plant", "Light",
  [ 0,  0,  0, -1,  2,  0,  2,  0,  2,  0],
  [ 2,  0,  0,  0,  5, -2,  5,  0,  2,  0],
  [ 2,  0,  0,  2, 10, -5,  5, -2,  5, -2]);

addFood(FOODS, "Light Fruit", "Fruit de lumi√®re", "Plant", "Light",
  [ 2,  0,  0, -1,  2,  0,  0,  0,  2,  0],
  [ 5, -2,  0,  0,  5,  0,  2,  0,  2,  0],
  [10, -5,  0,  2,  5, -2,  2,  0,  5, -2]);

addFood(FOODS, "Stamina Fruit", "Fruit d‚Äôendurance", "Plant", "Lightning",
  [ 2,  0,  0,  0, -1,  0,  2,  0,  2,  0],
  [ 5,  0,  0,  2,  0,  0,  5, -2,  2,  0],
  [ 5, -2,  0,  2,  2,  0, 10, -5,  5, -2]);

addFood(FOODS, "Water Fruit", "Fruit d‚Äôeau", "Plant", "Water",
  [-1,  0,  0,  2,  2,  0,  2,  0,  0,  0],
  [ 0,  0,  0,  5,  2,  0,  5, -2,  2,  0],
  [ 2,  0, -2,  5,  5, -2, 10, -5,  2,  0]);

addFood(FOODS, "Hyoi Pear", "Poire mojo", "Plant", "Wind",
  [-1,  0,  2,  0,  2,  0,  0,  0,  0,  2],
  [ 0,  0,  5,  0,  2,  0,  2,  0, -2,  5],
  [ 2,  0,  5, -2,  5, -2,  2,  0, -5, 10]);

addFood(FOODS, "Carrot", "Carotte", "Plant", "Lightning",
  [-1,  0,  2,  0,  0,  0,  0,  2,  0,  2],
  [ 0,  0,  2,  0,  2,  0, -2,  5,  0,  5],
  [ 2,  0,  5, -2,  2,  0, -5, 10, -2,  5]);

addFood(FOODS, "Ember Seeds", "Graines braise", "Plant", "Fire",
  [ 0,  0,  2,  0, -1,  0,  0,  2,  2,  0],
  [ 0,  2,  5, -2,  0,  0,  2,  5,  0,  0],
  [ 0,  2, 10, -5,  2,  0, -2,  5,  5, -2]);

addFood(FOODS, "Scent Seeds", "Graines parfum√©es", "Plant", "Darkness",
  [ 0,  0,  2,  0,  2,  0,  0,  2, -1,  0],
  [ 0,  2,  5,  0,  2,  0, -2,  5,  0,  0],
  [ 0,  2,  5, -2,  5, -2, -5, 10,  2,  0]);

addFood(FOODS, "Pegasus Seeds", "Graines P√©gase", "Plant", "Lightning",
  [ 0, -1,  0,  0,  2,  0,  0,  2,  2,  0],
  [ 0,  0,  2,  0,  2,  0, -2,  5,  5,  0],
  [ 0,  2,  2,  0,  5, -2, -5, 10,  5, -2]);

addFood(FOODS, "Gale Seeds", "Graines ouragan", "Plant", "Wind",
  [ 0,  2,  2,  0,  2,  0,  0,  0, -1,  0],
  [ 0,  2,  5, -2,  5,  0,  0,  2,  0,  0],
  [-2,  5, 10, -5,  5, -2,  0,  2,  2,  0]);

addFood(FOODS, "Mystery Seeds", "Graines myst√®re", "Plant", "Light",
  [ 0,  2,  2,  0,  2,  0,  0, -1,  0,  0],
  [ 0,  5,  2,  0,  5, -2,  0,  0,  2,  0],
  [-2,  5,  5, -2, 10, -5,  0,  2,  2,  0]);

addFood(FOODS, "Pumpkin", "Citrouille", "Plant", "Earth",
  [-1,  0,  0,  0,  2,  0,  2,  0,  2,  0],
  [ 0,  0,  0,  2,  2,  0,  2,  0,  5, -2],
  [ 2,  0,  0,  2,  5, -2,  5, -2, 10, -5]);

// --- Fish ---
addFood(FOODS, "Greengill", "Vertelette", "Fish", "Water",
  [ 0, -1,  0,  0,  2,  2,  0,  2,  0,  0],
  [ 0,  2,  0,  0, -2,  5,  2,  0,  5,  0],
  [ 0,  2,  2,  0, -5, 10,  5, -2,  5, -2]);

addFood(FOODS, "Ordon Catfish", "Silure d‚ÄôOrdon", "Fish", "Water",
  [ 0,  2,  2,  0,  0,  2, -1,  0,  0,  0],
  [-2,  5,  5,  0,  0,  2,  0,  0,  2,  0],
  [-5, 10,  5, -2, -2,  5,  2,  0,  2,  0]);

addFood(FOODS, "Hyrule Bass", "Perche d‚ÄôHyrule", "Fish", "Water",
  [ 0,  2,  2,  0,  0,  0,  2,  0, -1,  0],
  [-2,  5,  2,  0,  0,  2,  5,  0,  0,  0],
  [-5, 10,  5, -2,  0,  2,  5, -2,  2,  0]);

addFood(FOODS, "Hylian Pike", "Brochet d‚ÄôHyrule", "Fish", "Water",
  [ 0,  2,  0,  0,  0, -1,  2,  0,  2,  0],
  [ 0,  2,  2,  0,  0,  0,  5, -2,  5,  0],
  [-2,  5,  2,  0,  0,  2, 10, -5,  5, -2]);

addFood(FOODS, "Reekfish", "Poisson-puant", "Fish", "Water",
  [ 0,  2,  2,  0,  0, -1,  2,  0,  0,  0],
  [ 0,  2,  5, -2,  0,  0,  5,  0,  2,  0],
  [-2,  5, 10, -5,  0,  2,  5, -2,  2,  0]);

addFood(FOODS, "Hylian Loach", "Loche d‚ÄôHyrule", "Fish", "Water",
  [ 0,  2, -1,  0,  0,  2,  0,  0,  2,  0],
  [ 0,  2,  0,  0,  0,  5,  2,  0,  5, -2],
  [-2,  5,  2,  0, -2,  5,  2,  0, 10, -5]);

// --- Weird / Special (no Gratitude Crystals) ---
addFood(FOODS, "Mushroom Spores", "Spores de champignon", "Weird", "Darkness",
  [ 2,  0,  0,  2,  2,  0, -1,  0,  0,  0],
  [ 5, -2,  0,  2,  5,  0,  0,  0,  2,  0],
  [10, -5, -2,  5,  5, -2,  2,  0,  2,  0]);

addFood(FOODS, "Skullfish", "Poisson-squelette", "Weird", "Darkness",
  [ 0, -1,  2,  0,  0,  2,  2,  0,  0,  0],
  [ 0,  0,  5, -2,  0,  2,  5,  0,  2,  0],
  [ 0,  2, 10, -5, -2,  5,  5, -2,  2,  0]);

addFood(FOODS, "Bombfish", "Poisson-bombe", "Weird", "Fire",
  [ 0, -1,  2,  0,  0,  2,  0,  2,  0,  0],
  [ 0,  0,  5,  0,  0,  2,  2,  0,  5, -2],
  [ 0,  2,  5, -2,  0,  2,  5, -2, 10, -5]);

addFood(FOODS, "Chu Jelly", "Gel√©e Chu", "Weird", "Darkness",
  [ 0,  2,  2,  0,  0, -1,  2,  0,  0,  0],
  [ 0,  5,  2,  0,  0,  0,  5, -2,  2,  0],
  [-2,  5,  5, -2,  0,  2, 10, -5,  2,  0]);

addFood(FOODS, "Bee Larvae", "Larves d‚Äôabeille", "Weird", "Earth",
  [ 0,  0,  2,  0,  0, -1,  2,  0,  2,  0],
  [ 0,  2,  5,  0,  0,  0,  2,  0,  5, -2],
  [ 0,  2,  5, -2,  0,  2,  5, -2, 10, -5]);

addFood(FOODS, "Rock Sirloin", "Viande de roc", "Weird", "Earth",
  [ 0, -1,  2,  0,  0,  0,  2,  2,  0,  0],
  [ 0,  0,  5,  0,  2,  0, -2,  5,  2,  0],
  [ 0,  2,  5, -2,  2,  0, -5, 10,  5, -2]);

// =======================
// UI wiring
// =======================

const langSelect = document.getElementById("lang");
const personalitiesDiv = document.getElementById("personalities");
const skillsDiv = document.getElementById("skills");
const planBtn = document.getElementById("plan-btn");
const planOut = document.getElementById("plan-output");
const planWarn = document.getElementById("plan-warning");

let currentLang = "en";
const selectedPersonalities = new Set();
const targetTraits = new Set(TRAITS); // aim for all by default

function renderPersonalities() {
  personalitiesDiv.innerHTML = "";
  PERSONALITY_DEF.forEach(p => {
    const btn = document.createElement("div");
    btn.className = "personality";
    btn.dataset.trait = p.trait;

    const dot = document.createElement("div");
    dot.className = "state-dot";

    const label = document.createElement("span");
    label.textContent = currentLang === "en" ? p.en : p.fr;

    btn.appendChild(dot);
    btn.appendChild(label);

    btn.onclick = () => {
      const tr = p.trait;
      if (selectedPersonalities.has(tr)) {
        selectedPersonalities.delete(tr);
        btn.classList.remove("selected");
      } else {
        selectedPersonalities.add(tr);
        btn.classList.add("selected");
      }
    };

    personalitiesDiv.appendChild(btn);
  });
}

function renderSkills() {
  skillsDiv.innerHTML = "";
  TRAITS.forEach(tr => {
    const label = document.createElement("label");
    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.checked = true;
    cb.onchange = () => {
      if (cb.checked) targetTraits.add(tr);
      else targetTraits.delete(tr);
    };
    const span = document.createElement("span");
    span.textContent = tr;
    label.appendChild(cb);
    label.appendChild(span);
    skillsDiv.appendChild(label);
  });
}

function updateTexts() {
  const fr = currentLang === "fr";

  document.getElementById("lang-label").textContent = fr ? "Langue" : "Language";
  document.getElementById("subtitle").textContent = fr
    ? "Planifiez les repas pour que votre f√©e atteigne tous les traits n√©cessaires aux comp√©tences."
    : "Plan what to feed your fairy so she reaches all traits needed for every School skill.";

  document.getElementById("start-title").textContent = fr
    ? "Personnalit√©s de d√©part"
    : "Starting personalities";
  document.getElementById("start-help").textContent = fr
    ? "Touchez les personnalit√©s d√©j√† pr√©sentes sur votre f√©e. Cela ajuste l√©g√®rement les suggestions."
    : "Tap the personalities your fairy already has. This slightly nudges the suggestions.";

  document.getElementById("skills-title").textContent = fr
    ? "Traits pour les comp√©tences"
    : "Target skill traits";
  document.getElementById("skills-help").textContent = fr
    ? "Ces 10 traits servent aux comp√©tences de l‚Äô√âcole. Laissez tout coch√© pour viser toutes les comp√©tences."
    : "These 10 traits are used for School skills. Leave all checked to aim for every skill.";

  document.getElementById("plan-title").textContent = fr
    ? "Plan d‚Äôalimentation"
    : "Feeding plan";
  document.getElementById("plan-help").textContent = fr
    ? "Propose un m√©lange simple avec raret√© claire (bronze / Savoureux / D√©licieux) selon les valeurs du guide."
    : "Suggests a simple mix with clear rarities (bronze / Tasty / Delicious) based on the guide values.";

  document.getElementById("plan-btn-label").textContent = fr
    ? "Proposer des repas"
    : "Suggest foods";
}

langSelect.onchange = () => {
  currentLang = langSelect.value;
  updateTexts();
  renderPersonalities();
};

renderPersonalities();
renderSkills();
updateTexts();

// =======================
// Planner logic
// =======================

planBtn.onclick = () => {
  const needed = Array.from(targetTraits);
  planWarn.textContent = "";

  if (!needed.length) {
    planOut.textContent = currentLang === "fr"
      ? "S√©lectionnez au moins un trait √† viser."
      : "Select at least one trait to target.";
    return;
  }

  // Starting boost from selected personalities
  const current = {};
  TRAITS.forEach(t => current[t] = 0);
  selectedPersonalities.forEach(t => { current[t] += 3; });

  const TARGET = 30; // soft target for each selected trait
  const picks = [];

  function scoreFood(food) {
    let score = 0;
    for (const tr of needed) {
      const deficit = TARGET - current[tr];
      const d = food.traits[tr] || 0;
      if (deficit > 0 && d > 0) score += d;
      if (deficit > 0 && d < 0) score += d * 0.6; // penalize hurting needed traits
    }
    return score;
  }

  function bestFood() {
    let best = null;
    let bestScore = 0;
    for (const f of FOODS) {
      const s = scoreFood(f);
      if (s > bestScore + 0.0001) {
        bestScore = s;
        best = f;
      }
    }
    return best;
  }

  for (let i = 0; i < 80; i++) {
    const done = needed.every(tr => current[tr] >= TARGET);
    if (done) break;
    const food = bestFood();
    if (!food) break;
    picks.push(food);
    TRAITS.forEach(tr => { current[tr] += (food.traits[tr] || 0); });
  }

  if (!picks.length) {
    planOut.textContent = currentLang === "fr"
      ? "Aucune combinaison simple trouv√©e. Ajustez vos traits ou aliments."
      : "No simple combination found. Try adjusting traits or foods.";
    return;
  }

  // compress identical foods
  const map = {};
  for (const f of picks) {
    if (!map[f.key]) map[f.key] = { f, n: 0 };
    map[f.key].n++;
  }

  const lines = [];
  Object.values(map).forEach(({f, n}) => {
    const name = currentLang === "fr" ? f.name_fr : f.name_en;
    const rarity = currentLang === "fr" ? f.rarity_label_fr : f.rarity_label_en;
    lines.push(`‚Ä¢ x${n} ${name} [${rarity}, ${f.type}, ${f.element}]`);
  });

  planOut.innerHTML = lines.map(l => `<div class="food-line">${l}</div>`).join("");

  const missing = needed.filter(tr => current[tr] < TARGET);
  if (missing.length) {
    planWarn.textContent = (currentLang === "fr"
      ? "Remarque : ces traits restent un peu bas, compl√©tez avec vos propres choix : "
      : "Note: these traits are still a bit low; top them up with your own choices: "
    ) + missing.join(", ");
  } else {
    planWarn.textContent = currentLang === "fr"
      ? "Tous les traits cibl√©s atteignent un niveau correct. Ajustez selon vos stocks r√©els."
      : "All selected traits reach a good level. Tweak based on your actual inventory.";
  }
};
</script>
</body>
</html>
