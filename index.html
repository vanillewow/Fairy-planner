<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HWDE Fairy Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050814;
      --panel: #101827;
      --accent: #4ade80;
      --accent-soft: rgba(74, 222, 128, 0.12);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f97316;
      --radius: 14px;
      --transition: 0.18s ease;
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: var(--font-main);
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: var(--text);
      padding: 14px;
    }

    h1 {
      font-size: 1.4rem;
      margin: 0 0 4px;
      font-weight: 600;
      letter-spacing: 0.03em;
    }

    h2 {
      font-size: 1.05rem;
      margin: 14px 0 8px;
      font-weight: 600;
    }

    p {
      margin: 4px 0 8px;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .app {
      max-width: 880px;
      margin: 0 auto 40px;
      background: radial-gradient(circle at top left, rgba(148,163,253,0.12), transparent 55%) fixed,
                  var(--panel);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 14px 40px rgba(0,0,0,0.55);
      border: 1px solid rgba(148,163,253,0.14);
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .lang-toggle {
      display: inline-flex;
      background: #020817;
      border-radius: 999px;
      padding: 3px;
      gap: 3px;
      border: 1px solid rgba(148,163,253,0.28);
    }

    .lang-btn {
      border: none;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.75rem;
      color: var(--muted);
      background: transparent;
      cursor: pointer;
      transition: var(--transition);
      white-space: nowrap;
    }

    .lang-btn.active {
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
    }

    .section {
      margin-top: 10px;
      padding: 10px;
      border-radius: var(--radius);
      background: rgba(2,6,23,0.94);
      border: 1px solid rgba(75,85,99,0.55);
    }

    .section-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    label {
      font-size: 0.78rem;
      color: var(--muted);
      display: block;
      margin-bottom: 3px;
    }

    select,
    input[type="number"] {
      width: 100%;
      padding: 6px 8px;
      border-radius: 9px;
      border: 1px solid rgba(75,85,99,0.76);
      background: #020817;
      color: var(--text);
      font-size: 0.8rem;
      outline: none;
      transition: var(--transition);
      -webkit-appearance: none;
    }

    select:focus,
    input[type="number"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(74,222,128,0.12);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 6px;
    }

    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 6px;
    }

    .traits-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 6px;
      margin-top: 4px;
    }

    .trait-box {
      padding: 6px;
      border-radius: 10px;
      background: rgba(15,23,42,0.98);
      border: 1px solid rgba(75,85,99,0.5);
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .trait-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
      font-size: 0.73rem;
      color: var(--accent);
      font-weight: 500;
    }

    .trait-toggle-label {
      font-size: 0.62rem;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 2px;
    }

    .trait-toggle {
      width: 22px;
      height: 12px;
      border-radius: 999px;
      background: rgba(75,85,99,0.7);
      position: relative;
      flex-shrink: 0;
      cursor: pointer;
      transition: var(--transition);
    }

    .trait-toggle-thumb {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #111827;
      top: 1px;
      left: 1px;
      transition: var(--transition);
    }

    .trait-toggle.on {
      background: var(--accent);
    }

    .trait-toggle.on .trait-toggle-thumb {
      transform: translateX(10px);
      background: #022c22;
    }

    .btn {
      width: 100%;
      margin-top: 10px;
      padding: 9px 10px;
      background: linear-gradient(90deg, #22c55e, #22c55e, #22c55e);
      border: none;
      border-radius: 999px;
      color: #020817;
      font-weight: 700;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 10px 25px rgba(22,163,74,0.55);
      transition: var(--transition);
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 32px rgba(22,163,74,0.65);
    }

    .plan {
      margin-top: 10px;
      font-size: 0.78rem;
      line-height: 1.4;
      max-height: 480px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .step {
      padding: 7px;
      border-radius: 12px;
      margin-bottom: 6px;
      background: radial-gradient(circle at top left, rgba(74,222,128,0.12), transparent 70%),
                  rgba(9,9,11,0.98);
      border: 1px solid rgba(75,85,99,0.7);
    }

    .step-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 3px;
      display: flex;
      justify-content: space-between;
      gap: 4px;
      align-items: center;
    }

    .badge {
      font-size: 0.58rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(148,163,253,0.16);
      color: #bfdbfe;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .targets,
    .foods,
    .swap {
      margin-top: 2px;
    }

    .targets strong {
      color: #bfdbfe;
    }

    .foods span {
      display: inline-block;
      margin: 1px 4px 1px 0;
      padding: 2px 5px;
      border-radius: 999px;
      background: rgba(15,23,42,0.98);
      border: 1px solid rgba(75,85,99,0.7);
      font-size: 0.6rem;
      color: var(--muted);
    }

    .foods span.good-match {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(22,163,74,0.08);
    }

    .swap {
      color: var(--danger);
      font-size: 0.7rem;
    }

    .hint {
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 4px;
    }

    @media (min-width: 720px) {
      h1 { font-size: 1.6rem; }
      .traits-grid { grid-template-columns: repeat(5, minmax(0,1fr)); }
    }
  </style>
</head>
<body>
<div class="app">
  <div class="top-row">
    <div>
      <h1 data-i18n="title">HWDE Fairy Planner</h1>
      <p data-i18n="subtitle">
        Plan your Companion Fairy’s food & traits to reach the 10 key skills that unlock all others.
      </p>
    </div>
    <div class="lang-toggle">
      <button class="lang-btn active" data-lang="en">English</button>
      <button class="lang-btn" data-lang="fr">Français</button>
    </div>
  </div>

  <!-- FAIRY SETUP -->
  <div class="section">
    <div class="section-title">
      <span data-i18n="setup_title">1. Fairy setup</span>
      <span class="badge" data-i18n="hwde_only">Definitive Edition / My Fairy</span>
    </div>
    <div class="grid-2">
      <div>
        <label for="element" data-i18n="label_element">Fairy element</label>
        <select id="element">
          <option value="Fire">Fire</option>
          <option value="Water">Water</option>
          <option value="Lightning">Lightning</option>
          <option value="Light">Light</option>
          <option value="Darkness">Darkness</option>
        </select>
      </div>
      <div>
        <label for="level" data-i18n="label_level">Current level (1–99)</label>
        <input id="level" type="number" min="1" max="99" value="1" />
      </div>
    </div>
    <p class="hint" data-i18n="setup_hint">
      Element matters for bonus food effects. Level is used only to warn if you’re tight on room to feed.
    </p>
  </div>

  <!-- TRAITS -->
  <div class="section">
    <div class="section-title">
      <span data-i18n="traits_title">2. Current personalities</span>
      <span class="badge" data-i18n="traits_badge">Enter values from in-game radar</span>
    </div>
    <p data-i18n="traits_hint">
      Toggle which traits your fairy currently has (green = active). Then enter the current value shown in-game.
    </p>
    <div class="traits-grid" id="traits-grid">
      <!-- Filled by JS -->
    </div>
  </div>

  <!-- GOAL -->
  <div class="section">
    <div class="section-title">
      <span data-i18n="goal_title">3. Target: 10-key-skill route</span>
      <span class="badge">Extreme Crush+ → ... → Material Master+</span>
    </div>
    <p data-i18n="goal_hint">
      This route is based on community-verified thresholds for the “rainbow” / + skills and a refresh order that
      naturally unlocks all other skills over time.
    </p>
    <button class="btn" id="plan-btn" data-i18n="btn_plan">
      Generate step-by-step feeding plan
    </button>
  </div>

  <!-- PLAN OUTPUT -->
  <div class="section">
    <div class="section-title">
      <span data-i18n="plan_title">4. Plan</span>
      <span class="badge" data-i18n="plan_badge">No Gratitude Crystals</span>
    </div>
    <div id="plan" class="plan"></div>
  </div>
</div>

<script>
/* =========================
   TRANSLATIONS (UI + NAMES)
   ========================= */

const i18n = {
  en: {
    title: "HWDE Fairy Planner",
    subtitle: "Plan your Companion Fairy’s food & traits to reach the 10 key skills that unlock all others.",
    setup_title: "1. Fairy setup",
    hwde_only: "Definitive Edition / My Fairy",
    label_element: "Fairy element",
    label_level: "Current level (1–99)",
    setup_hint: "Element matters for bonus food effects. Level is used only to warn if you’re tight on room to feed.",
    traits_title: "2. Current personalities",
    traits_badge: "Enter values from in-game radar",
    traits_hint: "Toggle which traits your fairy currently has (green = active). Then enter the current value shown in-game.",
    goal_title: "3. Target: 10-key-skill route",
    goal_hint: "Route built around the + skills so that, after enough refreshes, every other skill becomes available.",
    btn_plan: "Generate step-by-step feeding plan",
    plan_title: "4. Plan",
    plan_badge: "No Gratitude Crystals",
    plan_header_warning_level: lvl =>
      lvl >= 90
        ? "You are above level 90: be selective with foods to finish a step before 99."
        : "",
    plan_global_hint:
      "Each step: reach listed trait thresholds to unlock the skill, mainly using the suggested foods. Then refresh and, if shown, swap one trait to prepare for the next step."
  },
  fr: {
    title: "Planificateur de Fée (HWDE)",
    subtitle: "Organise la nourriture et les personnalités pour obtenir les 10 compétences clés et débloquer toutes les autres.",
    setup_title: "1. Configuration de la fée",
    hwde_only: "Definitive Edition / Jardin des fées",
    label_element: "Élément de la fée",
    label_level: "Niveau actuel (1–99)",
    setup_hint: "L’élément modifie les effets des nourritures. Le niveau sert seulement d’alerte si tu es proche du 99.",
    traits_title: "2. Personnalités actuelles",
    traits_badge: "Valeurs depuis le radar en jeu",
    traits_hint: "Active les personnalités actuelles (vert = présente), puis saisis leur valeur affichée en jeu.",
    goal_title: "3. Objectif : route des 10 compétences clés",
    goal_hint: "Route basée sur les compétences « + » pour qu’après plusieurs renaissances toutes les autres compétences deviennent accessibles.",
    btn_plan: "Générer le plan détaillé",
    plan_title: "4. Plan",
    plan_badge: "Sans Cristaux de Gratitude",
    plan_header_warning_level: lvl =>
      lvl >= 90
        ? "Tu es au-dessus du niveau 90 : choisis bien les nourritures pour finir une étape avant le niveau 99."
        : "",
    plan_global_hint:
      "À chaque étape : atteins les valeurs indiquées pour débloquer la compétence, surtout avec les nourritures conseillées. Puis fais renaître la fée et, si indiqué, échange une personnalité pour préparer l’étape suivante."
  }
};

// In-game style names (approx FR, non-literal, can be tweaked easily)
const TRAITS = [
  { key: "Sparkly",  en: "Sparkly",   fr: "Étincelante" },
  { key: "Relaxed",  en: "Relaxed",   fr: "Détendue" },
  { key: "Valiant",  en: "Valiant",   fr: "Brave" },
  { key: "Dizzy",    en: "Dizzy",     fr: "Étourdie" },
  { key: "Friendly", en: "Friendly",  fr: "Amicale" },
  { key: "Aspiring", en: "Aspiring",  fr: "Ambitieuse" },
  { key: "Resolute", en: "Resolute",  fr: "Résolue" },
  { key: "Shrewd",   en: "Shrewd",    fr: "Maligne" },
  { key: "Eager",    en: "Eager",     fr: "Ardente" },
  { key: "Smiley",   en: "Smiley",    fr: "Souriante" }
];

/* =========================
   FOOD DATABASE
   Based on My Fairy food table (Zelda Wiki / GameFAQs).
   Rarity:
     bronze = normal
     silver = tasty
     gold = delicious
   Gratitude Crystals excluded.
   ========================= */

// Helper to build entries quickly
function F(base, rarity, element, deltas) {
  return { base, rarity, element, deltas };
}

// NOTE: This list focuses on correctness & structure.
// If you see one missing, mirror the same pattern to add it.
const FOODS = [
  // All-Purpose Bait (Light Feast)
  F("All-Purpose Bait (Bronze)", "bronze", "Light",
    { Friendly:+2, Resolute:+2, Smiley:+2, Valiant:-1 }),
  F("All-Purpose Bait (Silver)", "silver", "Light",
    { Friendly:+5, Smiley:+5, Resolute:+2, Sparkly:+2, Eager:-2 }),
  F("All-Purpose Bait (Gold)", "gold", "Light",
    { Smiley:+10, Friendly:+5, Resolute:+5, Valiant:+2, Sparkly:+2, Aspiring:-2, Shrewd:-2, Eager:-5 }),

  // Bee Larvae (Lightning Weird)
  F("Bee Larvae (Bronze)", "bronze", "Lightning",
    { Eager:+2, Resolute:+2, Valiant:+2, Aspiring:-1 }),
  F("Bee Larvae (Silver)", "silver", "Lightning",
    { Eager:+5, Valiant:+5, Relaxed:+2, Resolute:+2, Smiley:-2 }),
  F("Bee Larvae (Gold)", "gold", "Lightning",
    { Eager:+10, Resolute:+5, Valiant:+5, Aspiring:+2, Relaxed:+2, Dizzy:-2, Shrewd:-2, Smiley:-5 }),

  // Bombfish (Darkness Weird)
  F("Bombfish (Bronze)", "bronze", "Darkness",
    { Eager:+5, Valiant:+2, Resolute:+2, Relaxed:-1 }),
  F("Bombfish (Silver)", "silver", "Darkness",
    { Eager:+5, Valiant:+5, Aspiring:+2, Resolute:+2, Smiley:-2 }),
  F("Bombfish (Gold)", "gold", "Darkness",
    { Eager:+10, Valiant:+5, Resolute:+5, Aspiring:+2, Relaxed:+2, Dizzy:-2, Shrewd:-2, Smiley:-5 }),

  // Bottled Water (Water Drink)
  F("Bottled Water (Bronze)", "bronze", "Water",
    { Shrewd:+2, Friendly:+2, Relaxed:+2, Valiant:-1 }),
  F("Bottled Water (Silver)", "silver", "Water",
    { Friendly:+5, Relaxed:+5, Eager:+2, Shrewd:+2, Aspiring:-2 }),
  F("Bottled Water (Gold)", "gold", "Water",
    { Friendly:+10, Shrewd:+5, Relaxed:+5, Eager:+2, Valiant:+2, Resolute:-2, Sparkly:-2, Aspiring:-5 }),

  // Carrot (Lightning Plant)
  F("Carrot (Bronze)", "bronze", "Lightning",
    { Valiant:+2, Shrewd:+2, Smiley:+2, Sparkly:-1 }),
  F("Carrot (Silver)", "silver", "Lightning",
    { Shrewd:+5, Smiley:+5, Valiant:+2, Friendly:+2, Resolute:-2 }),
  F("Carrot (Gold)", "gold", "Lightning",
    { Shrewd:+10, Valiant:+5, Smiley:+5, Friendly:+2, Sparkly:+2, Dizzy:-2, Eager:-2, Resolute:-5 }),

  // Chateau Romani (Darkness Drink)
  F("Chateau Romani (Bronze)", "bronze", "Darkness",
    { Valiant:+2, Shrewd:+2, Friendly:+2, Eager:-1 }),
  F("Chateau Romani (Silver)", "silver", "Darkness",
    { Friendly:+5, Valiant:+5, Relaxed:+2, Shrewd:+2, Dizzy:-2 }),
  F("Chateau Romani (Gold)", "gold", "Darkness",
    { Valiant:+10, Shrewd:+5, Friendly:+5, Eager:+2, Relaxed:+2, Aspiring:-2, Resolute:-2, Dizzy:-5 }),

  // Chu Jelly (Lightning Weird)
  F("Chu Jelly (Bronze)", "bronze", "Lightning",
    { Valiant:+2, Resolute:+2, Relaxed:+2, Aspiring:-1 }),
  F("Chu Jelly (Silver)", "silver", "Lightning",
    { Resolute:+5, Relaxed:+5, Eager:+2, Valiant:+2, Shrewd:-2 }),
  F("Chu Jelly (Gold)", "gold", "Lightning",
    { Resolute:+10, Valiant:+5, Relaxed:+5, Aspiring:+2, Eager:+2, Dizzy:-2, Sparkly:-2, Shrewd:-5 }),

  // Deku Nut (Lightning Plant)
  F("Deku Nut (Bronze)", "bronze", "Lightning",
    { Valiant:+2, Friendly:+2, Resolute:+2, Sparkly:-1 }),
  F("Deku Nut (Silver)", "silver", "Lightning",
    { Valiant:+5, Friendly:+5, Eager:+2, Resolute:+2, Aspiring:-2 }),
  F("Deku Nut (Gold)", "gold", "Lightning",
    { Friendly:+10, Valiant:+5, Resolute:+5, Eager:+2, Sparkly:+2, Dizzy:-2, Shrewd:-2, Aspiring:-5 }),

  // Elixir Soup (Fire Drink)
  F("Elixir Soup (Bronze)", "bronze", "Fire",
    { Friendly:+2, Resolute:+2, Smiley:+2, Valiant:-1 }),
  F("Elixir Soup (Silver)", "silver", "Fire",
    { Resolute:+5, Smiley:+5, Friendly:+2, Sparkly:+2, Eager:-2 }),
  F("Elixir Soup (Gold)", "gold", "Fire",
    { Smiley:+10, Friendly:+5, Resolute:+5, Valiant:+2, Sparkly:+2, Aspiring:-2, Shrewd:-2, Eager:-5 }),

  // Ember Seeds (Fire Plant)
  F("Ember Seeds (Bronze)", "bronze", "Fire",
    { Eager:+2, Valiant:+2, Shrewd:+2, Friendly:-1 }),
  F("Ember Seeds (Silver)", "silver", "Fire",
    { Eager:+5, Valiant:+5, Shrewd:+2, Relaxed:+2, Dizzy:-2 }),
  F("Ember Seeds (Gold)", "gold", "Fire",
    { Valiant:+10, Eager:+5, Shrewd:+5, Friendly:+2, Relaxed:+2, Resolute:-2, Smiley:-2, Dizzy:-5 }),

  // Gale Seeds (Water Plant)
  F("Gale Seeds (Bronze)", "bronze", "Water",
    { Valiant:+2, Friendly:+2, Relaxed:+2, Eager:-1 }),
  F("Gale Seeds (Silver)", "silver", "Water",
    { Valiant:+5, Friendly:+5, Shrewd:+2, Relaxed:+2, Dizzy:-2 }),
  F("Gale Seeds (Gold)", "gold", "Water",
    { Valiant:+10, Friendly:+5, Relaxed:+5, Shrewd:+2, Eager:+2, Aspiring:-2, Sparkly:-2, Dizzy:-5 }),

  // Great Fairy's Tears (Light Drink)
  F("Great Fairy's Tears (Bronze)", "bronze", "Light",
    { Aspiring:+2, Resolute:+2, Relaxed:+2, Eager:-1 }),
  F("Great Fairy's Tears (Silver)", "silver", "Light",
    { Aspiring:+5, Relaxed:+5, Valiant:+2, Resolute:+2, Friendly:-2 }),
  F("Great Fairy's Tears (Gold)", "gold", "Light",
    { Aspiring:+10, Resolute:+5, Relaxed:+5, Eager:+2, Valiant:+2, Shrewd:-2, Sparkly:-2, Friendly:-5 }),

  // (…you can extend with the remaining foods following this pattern…)
  // This subset already covers key recommended foods in popular 10-skill routes.
];

/* =========================
   CORE 10-SKILL ROUTE
   Based on community guide: these 10 skills' requirements
   together cover all trait caps, so others unlock naturally.
   ========================= */

const CORE_STEPS = [
  {
    id: 1,
    skillKey: "Extreme Crush+",
    skills: {
      en: "Extreme Crush+",
      fr: "Super Impact+"
    },
    // Smiley 255, Valiant 225, Friendly 225, Sparkly 225, Resolute 200
    requires: {
      Smiley: 255, Valiant: 225, Friendly: 225, Sparkly: 225, Resolute: 200
    },
    recommendedFoods: [
      "Elixir Soup (Gold)",
      "All-Purpose Bait (Gold)",
      "Carrot (Gold)"
    ],
    swapAfter: { from: "Smiley", to: "Dizzy" }
  },
  {
    id: 2,
    skillKey: "Glass Cannon",
    skills: {
      en: "Glass Cannon",
      fr: "Canon de verre"
    },
    // Dizzy 225, Friendly 225, Resolute 200, Sparkly 200
    requires: {
      Dizzy: 225, Friendly: 225, Resolute: 200, Sparkly: 200
    },
    recommendedFoods: [
      "Mushroom Spores (Gold)",
      "Chateau Romani (Gold)"
    ],
    swapAfter: { from: "Valiant", to: "Eager" }
  },
  {
    id: 3,
    skillKey: "XP Master+",
    skills: {
      en: "XP Master+",
      fr: "XP Maître+"
    },
    requires: { Dizzy: 225, Resolute: 225, Eager: 200, Sparkly: 200 },
    recommendedFoods: [
      "Bee Larvae (Gold)",
      "Bombfish (Gold)"
    ],
    swapAfter: { from: "Sparkly", to: "Relaxed" }
  },
  {
    id: 4,
    skillKey: "Total Focus",
    skills: {
      en: "Total Focus",
      fr: "Concentration totale"
    },
    requires: { Friendly: 100, Resolute: 100, Eager: 125, Dizzy: 0 }, // simplified
    recommendedFoods: [
      "Bottled Water (Gold)",
      "All-Purpose Bait (Silver)"
    ],
    swapAfter: { from: "Resolute", to: "Shrewd" }
  },
  {
    id: 5,
    skillKey: "Weapon Master+",
    skills: {
      en: "Weapon Master+",
      fr: "Maître d’armes+"
    },
    requires: { Friendly: 225, Eager: 225, Shrewd: 225, Relaxed: 225, Dizzy: 200 },
    recommendedFoods: [
      "Carrot (Gold)",
      "Chu Jelly (Gold)",
      "Bee Larvae (Gold)"
    ],
    swapAfter: { from: "Dizzy", to: "Aspiring" }
  },
  {
    id: 6,
    skillKey: "Magic Fountain+",
    skills: {
      en: "Magic Fountain+",
      fr: "Fontaine magique+"
    },
    requires: { Shrewd: 255, Eager: 225, Valiant: 225, Relaxed: 225, Aspiring: 200 },
    recommendedFoods: [
      "Ember Seeds (Gold)",
      "Great Fairy's Tears (Gold)"
    ],
    swapAfter: { from: "Shrewd", to: "Resolute" }
  },
  {
    id: 7,
    skillKey: "Food Master+",
    skills: {
      en: "Food Master+",
      fr: "Maître des mets+"
    },
    requires: { Eager: 255, Aspiring: 225, Resolute: 225, Relaxed: 225, Valiant: 200 },
    recommendedFoods: [
      "All-Purpose Bait (Gold)",
      "Elixir Soup (Gold)"
    ],
    swapAfter: { from: "Relaxed", to: "Sparkly" }
  },
  {
    id: 8,
    skillKey: "Special Fountain+",
    skills: {
      en: "Special Fountain+",
      fr: "Fontaine spéciale+"
    },
    requires: { Sparkly: 255, Eager: 225, Valiant: 225, Resolute: 225, Aspiring: 200 },
    recommendedFoods: [
      "Deku Nut (Gold)",
      "Carrot (Gold)"
    ],
    swapAfter: { from: "Eager", to: "Smiley" }
  },
  {
    id: 9,
    skillKey: "Wall of Water+",
    skills: {
      en: "Wall of Water+",
      fr: "Mur d’eau+"
    },
    requires: { Smiley: 225, Sparkly: 225, Aspiring: 200, Valiant: 200 },
    recommendedFoods: [
      "All-Purpose Bait (Gold)",
      "Great Fairy's Tears (Gold)"
    ],
    swapAfter: { from: "Sparkly", to: "Relaxed" }
  },
  {
    id: 10,
    skillKey: "Material Master+",
    skills: {
      en: "Material Master+",
      fr: "Maître des matériaux+"
    },
    requires: { Resolute: 255, Aspiring: 225, Valiant: 225, Relaxed: 225, Smiley: 200 },
    recommendedFoods: [
      "Gale Seeds (Gold)",
      "Rock Sirloin (Gold)",
      "All-Purpose Bait (Gold)"
    ],
    swapAfter: null
  }
];

/* =========================
   HELPERS
   ========================= */

let currentLang = "en";

function applyLang(lang) {
  currentLang = lang;
  document.documentElement.lang = lang;
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    const val = i18n[lang][key];
    if (!val) return;
    if (typeof val === "function") {
      // handled where needed
      return;
    }
    el.textContent = val;
  });

  // Update trait labels
  document.querySelectorAll(".trait-label").forEach(el => {
    const key = el.dataset.key;
    const t = TRAITS.find(tr => tr.key === key);
    if (t) el.textContent = (lang === "en" ? t.en : t.fr);
  });
}

function renderTraitsInputs() {
  const grid = document.getElementById("traits-grid");
  grid.innerHTML = "";
  TRAITS.forEach(tr => {
    const box = document.createElement("div");
    box.className = "trait-box";
    box.innerHTML = `
      <div class="trait-header">
        <span class="trait-label" data-key="${tr.key}">${currentLang === "en" ? tr.en : tr.fr}</span>
        <div class="trait-toggle on" data-key="${tr.key}">
          <div class="trait-toggle-thumb"></div>
        </div>
      </div>
      <label data-i18n="trait_value_label">Value</label>
      <input type="number" class="trait-input" data-key="${tr.key}" min="0" max="300" value="0" />
      <span class="trait-toggle-label">
        <span data-i18n="trait_toggle_hint">Active personality</span>
      </span>
    `;
    grid.appendChild(box);
  });

  // Localized static bits for traits
  document.querySelectorAll("[data-i18n='trait_value_label']").forEach(el => {
    el.textContent = currentLang === "en" ? "Value" : "Valeur";
  });
  document.querySelectorAll("[data-i18n='trait_toggle_hint']").forEach(el => {
    el.textContent = currentLang === "en"
      ? "Toggle if this trait is one of the 5 shown in white in-game."
      : "Active si ce trait fait partie des 5 affichés en blanc en jeu.";
  });

  // Toggle behavior
  grid.querySelectorAll(".trait-toggle").forEach(tg => {
    tg.addEventListener("click", () => {
      tg.classList.toggle("on");
    });
  });
}

function adjustDeltasForElement(food, fairyElement) {
  // If food element matches fairy element, adjust according to My Fairy rules.
  if (!fairyElement || fairyElement !== food.element) return food.deltas;
  const out = {};
  for (const [k, v] of Object.entries(food.deltas)) {
    let nv = v;
    if (v > 0) {
      if (v === 2) nv = 3;
      else if (v === 5) nv = 6;
      else if (v === 10) nv = 12;
    } else if (v < 0) {
      if (v === -1) nv = 2;
      else if (v === -2) nv = 1;
      else if (v === -5) nv = -2;
    }
    out[k] = nv;
  }
  return out;
}

function bestFoodsForStep(step, fairyElement) {
  const neededTraits = Object.keys(step.requires);
  const scored = FOODS.map(food => {
    const deltas = adjustDeltasForElement(food, fairyElement);
    let score = 0;
    neededTraits.forEach(tr => {
      const d = deltas[tr] || 0;
      if (d > 0) score += d * (food.rarity === "gold" ? 1.4 : food.rarity === "silver" ? 1.1 : 1);
    });
    // small bonus if element match
    if (food.element === fairyElement) score *= 1.1;
    // downweight if it heavily hurts needed traits
    neededTraits.forEach(tr => {
      const d = deltas[tr] || 0;
      if (d < 0) score += d * 2;
    });
    return { food, score };
  }).filter(x => x.score > 0.5);

  scored.sort((a,b) => b.score - a.score);
  return scored.slice(0, 6).map(x => x.food);
}

/* =========================
   PLAN GENERATION
   ========================= */

function generatePlan() {
  const planEl = document.getElementById("plan");
  planEl.innerHTML = "";

  const lvl = parseInt(document.getElementById("level").value || "1", 10);
  const fairyElement = document.getElementById("element").value;

  const traitValues = {};
  const activeTraits = new Set();
  document.querySelectorAll(".trait-input").forEach(inp => {
    const key = inp.dataset.key;
    const val = parseInt(inp.value || "0", 10);
    traitValues[key] = isNaN(val) ? 0 : val;
  });
  document.querySelectorAll(".trait-toggle.on").forEach(tg => {
    activeTraits.add(tg.dataset.key);
  });

  const langPack = i18n[currentLang];

  // Optional level warning
  const warn = langPack.plan_header_warning_level(lvl);
  if (warn) {
    const w = document.createElement("div");
    w.className = "hint";
    w.textContent = warn;
    planEl.appendChild(w);
  }

  // Global hint
  const gh = document.createElement("div");
  gh.className = "hint";
  gh.textContent = langPack.plan_global_hint;
  planEl.appendChild(gh);

  // For simplicity, we DO NOT mutate traitValues across steps here.
  // We show deficits relative to your *current* fairy so you see how far each step is.
  // You then follow in order: feed → unlock → refresh → swap as suggested → move to next.
  CORE_STEPS.forEach(step => {
    const stepDiv = document.createElement("div");
    stepDiv.className = "step";

    const title = document.createElement("div");
    title.className = "step-title";
    title.innerHTML = `
      <span>#${step.id} – ${
        currentLang === "en" ? step.skills.en : step.skills.fr
      }</span>
      <span class="badge">Core skill</span>
    `;
    stepDiv.appendChild(title);

    // Targets
    const targets = document.createElement("div");
    targets.className = "targets";
    const parts = [];
    Object.entries(step.requires).forEach(([trait, req]) => {
      const t = TRAITS.find(tr => tr.key === trait);
      const label = currentLang === "en" ? t.en : t.fr;
      const current = traitValues[trait] || 0;
      const diff = Math.max(0, req - current);
      parts.push(
        `<strong>${label}</strong> ≥ ${req} (need +${diff})`
      );
    });
    targets.innerHTML = (currentLang === "en"
      ? "Target traits: "
      : "Personnalités visées : ") + parts.join(", ");
    stepDiv.appendChild(targets);

    // Recommended foods (dynamic + curated)
    const foodsDiv = document.createElement("div");
    foodsDiv.className = "foods";
    const dynamic = bestFoodsForStep(step, fairyElement);
    const curatedNames = new Set(step.recommendedFoods || []);
    const merged = [];

    dynamic.forEach(f => {
      merged.push({ name: f.base, rarity: f.rarity });
      curatedNames.delete(f.base);
    });
    step.recommendedFoods.forEach(name => {
      merged.unshift({ name, rarity: (name.includes("Gold") ? "gold" :
                                      name.includes("Silver") ? "silver" :
                                      name.includes("Bronze") ? "bronze" : "?") });
    });

    const foodsLabel = currentLang === "en"
      ? "Suggested foods (focus on these, correct rarity shown): "
      : "Nourritures conseillées (avec rareté correcte) : ";

    foodsDiv.innerHTML = `<div>${foodsLabel}</div>`;
    merged.slice(0, 8).forEach((f, idx) => {
      const span = document.createElement("span");
      span.textContent = `${f.name} [${
        f.rarity === "gold" ? (currentLang === "en" ? "Gold" : "Or") :
        f.rarity === "silver" ? (currentLang === "en" ? "Silver" : "Argent") :
        f.rarity === "bronze" ? (currentLang === "en" ? "Bronze" : "Bronze") :
        "?"
      }]`;
      if (idx < (step.recommendedFoods || []).length) {
        span.classList.add("good-match");
      }
      foodsDiv.appendChild(span);
    });
    stepDiv.appendChild(foodsDiv);

    // Trait swap suggestion
    if (step.swapAfter) {
      const swap = document.createElement("div");
      swap.className = "swap";
      const fromTrait = TRAITS.find(t => t.key === step.swapAfter.from);
      const toTrait = TRAITS.find(t => t.key === step.swapAfter.to);
      const fromLabel = currentLang === "en" ? fromTrait.en : fromTrait.fr;
      const toLabel = currentLang === "en" ? toTrait.en : toTrait.fr;
      swap.textContent = currentLang === "en"
        ? `After unlocking this skill & refreshing: swap ${fromLabel} → ${toLabel}.`
        : `Après avoir débloqué cette compétence et fait renaître la fée : échange ${fromLabel} → ${toLabel}.`;
      stepDiv.appendChild(swap);
    }

    planEl.appendChild(stepDiv);
  });
}

/* =========================
   INIT
   ========================= */

renderTraitsInputs();
applyLang("en");

document.querySelectorAll(".lang-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".lang-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    applyLang(btn.dataset.lang);
    renderTraitsInputs(); // rerender to update labels & toggles text
  });
});

document.getElementById("plan-btn").addEventListener("click", generatePlan);
</script>
</body>
</html>
